<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorator="layout/popup2">
<head>
<meta charset="utf-8" />
<title>공통팝업</title>

	<!-- css -->
	<th:block layout:fragment="css">
		<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="/css/theme.css" />
		
		<link rel="stylesheet" href="/css/jstree/themes/default/style.min.css" />
	</th:block>

	 <th:block layout:fragment="script">
	    
	    <script src="/js/jstree/jstree.min.js"></script>
	    
		<script>
		
		 	var treeData = [];
		 	
		 	$(function() {
				
				  	getCodeList(); 
					
					/* $('#jstree').on("changed.jstree", function (e, data) {
						  //console.log(data); 
					}); */
					
					//항목 더블클릭시
					$('#jstree').on("dblclick.jstree", function (event) {
						 returnResult();  
					});
					
					//팝업창 닫기
					$("#btn_close_pop").on("click",function(){ 
						window.close();
					});
					
					$(".btn_srch").on("click",function (){ 
						$('#jstree').jstree().destroy();
		    	    	getCodeList();
			        });
					
					$("#tree_open").on("click",function (){ 
						$('#jstree').jstree("open_all");
			        });
					$("#tree_close").on("click",function (){ 
						$('#jstree').jstree("close_all");
			        });
					
		  });
		
		function getTree() {
			
          	$('#jstree').jstree({ 'core' : {
			    "data": treeData,
			    "check_callback" : true,
				},
          	    "plugins": ["contextmenu","themes","ui","types","wholerow"],
				"contextmenu" : { "items" : 
											{ "confirm" : { 
															"separator_before" : false
														  , "separator_after" : false
														  , "label" : "선택"
														  , "icon" : "/images/common/confirm.png"
														  , "action" : function(obj){
												             returnResult();
											              } 
				                             }
				                 } 
			    }
				//,"themes": {"theme":"default","dots":true, "icons":true}
				/* ,"types" : {
					'default' : { 'icon' : 'folder' },
					'file' : { 'valid_children' : [], 'icon' : 'file' }
				}, */

			}); 
			
		}
			
		//공통코드(트리) 조회
		function getCodeList() {
			
			treeData.length=0;
			
			let url = "/common/popup/codeTreeList";
			let reqType = 'GET';	
			let data = {
				"codeGrpId" : $("#codeGrpId").text()
			};
			 
			$.commRequest(url, reqType, data)
				.then((res) => {
					console.log('공통코드 조회 성공!!');
					treeData = res.data;	
					//$('#jstree').trigger("load_all.jstree");
					getTree();
				})
				.catch((error) => {
					console.log('공통코드 조회 실패!!');
				});
			
		}
		
 
		   function returnResult() {
			   
			   var item = $("#jstree").jstree('get_selected', true);
	           var result = {};
	           result.codeCd = item[0].id;
	           result.codeNm = item[0].text;
			   
			   opener.setResult2(result);
			   window.close();
		   }
			
		  
		</script>
	</th:block> 

</head>
<body >

<div layout:fragment="content">

	<span id="codeGrpId" th:text="${param.codeGrpId}" style="display:none;"></span>
	 	 
	<!-- pop_alert -->
	<div id="pop_wrap" >
	<!-- [D] 현재 팝업창 크기는 600*600 입니다. 콘텐츠에 따라서 크기를 변경하여 주십시오.-->
					<!-- head -->
					<h3>자산유형 선택
						 <!-- <a href="#;" id="btn_close_pop" class="pop_close" title="닫기">닫기</a> -->
					</h3>
					<!-- //head -->
					<!-- contents -->
					<div id="contents" style="height:380px;">
	
						<!-- search -->
						<div class="srch_wrap">
							<!-- search_form -->
							<div class="srch_form">
								<table class="srch_table">
									<colgroup>
											<col width="15%"/>
											<col width="40%"/>
											<col width="15%"/>
											<col width=""/>
									</colgroup>
									<tr>
										<th>&nbsp;</th>
										<td>&nbsp;</td>
									</tr>
								</table>
								<!-- search_button -->
								<div class="button">
									<img id="tree_open" src="/images/common/plus.png" style="padding-top:4px;cursor:pointer;" title="펼치기">
									<img id="tree_close" src="/images/common/minus.png" style="padding-top:4px;cursor:pointer;" title="접기">
									&nbsp;&nbsp;
									<a href="#;" class="btn_srch">새로고침</a>
								</div>
								<!-- //search_button -->
							</div>
							<!-- //search_form -->
						</div>
						<!-- //search -->

						<!-- list 1 -->
						<div class="box_form" style="overflow:auto;height:270px;">
							<div id="jstree"></div>
						</div>
						<!-- //list 1 -->
	
					</div>
					<!-- contents -->
					<!-- button -->
					<div class="pop_button">
						<p>
						<p>
						<a href="#;" id="btn_close_pop" class="btn_list_rd">닫기</a>
						</p>
					</div>
					<!-- //button -->
	</div>
	<!-- //pop_alert -->
</div>

</body>
</html>