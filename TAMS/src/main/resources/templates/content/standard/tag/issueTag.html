<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
        layout:decorator="layout/default">
       
	<head>
	    <title>[[#{screen.text.asset.asetInspList}]]</title>
	</head>
        
        
	<!-- css -->
	<th:block layout:fragment="css">
	    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="/css/jsgrid.css" />
		<link rel="stylesheet" href="/css/theme.css" />
	</th:block>  
	
	<th:block layout:fragment="script">
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
		<script src="/js/jsgrid/db.js"></script>
	    <script src="/js/jsgrid/jsgrid.core.js"></script>
	    <script src="/js/jsgrid/jsgrid.load-indicator.js"></script>
	    <script src="/js/jsgrid/jsgrid.load-strategies.js"></script>
	    <script src="/js/jsgrid/jsgrid.sort-strategies.js"></script>
	    <script src="/js/jsgrid/jsgrid.field.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.text.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.number.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.select.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.checkbox.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.control.js"></script>	
	
		<script>
		const SCREEN_NM     = "INSP_SEARCH_LIST"; 
	    let menuId = "[[${menuId}]]";
	    let numOfRows = 30; //basic = 30
	    let invData = {};
    	var inspStusArr   = [];
    	var inspMtdArr    = [];
    	var inspCmplYnArr = [];
    	var inspPtclArr   = [];
	    
		$(function(){
			
			jsGridLoad();
			
			// 태그발행여부 세팅
			var tagYnStr = "";
				tagYnStr += '<option value="Y">Y</option>';
				tagYnStr += '<option value="N">N</option>';
			$("#tagYn").append(tagYnStr);
			
	        //자산유형1 코드 조회
	        getCommCode("#asetType1", "AS_CLASS", "1", "");
	        
	      	//자산유형1 change 이벤트
	        $("#asetType1").change(function(){
	        	let type1 = $("#asetType1").val();

        		$('#asetType2').children('option:not(:first)').remove();
        		$('#asetType3').children('option:not(:first)').remove();
        		
	        	if(type1 != 'ALL') {
	        		getCommCode("#asetType2", "AS_CLASS", "2", type1);
	        	}
	        });
	        
	        //자산유형2 change 이벤트
	        $("#asetType2").change(function(){
	        	let type2 = $("#asetType2").val();
	        	
	        	$('#asetType3').children('option:not(:first)').remove();
	        	
	        	if(type2 != 'ALL') {		        		
	        		getCommCode("#asetType3", "AS_CLASS", "3", type2);
	        	}
	        });	
	        
	        let DEPT_URL = "/common/popup/deptTreePopup";
	        let DEPT_ID = "DeptPopup";
	        let DEPT_ARGS = {
        		width:500,
        	    height:450,
        	    fullscreen:"no",
        	    resizable:"no"	        	        		
	        };	   
	        
	        //사업부 조회
     	    $("#bizDeptPopup").on("click", function() {
		     	var params = {
        	        searchType:"BIZ_DEPT",
     	        	deptCd:"#bizDeptCd",
     	        	deptNm:"#bizDeptNm" 	  	        	        	         	    		
         	    }; 	        		        	        
        	    openPopup2(DEPT_ID, DEPT_URL, DEPT_ARGS, params);
         	 });	
     	    
	        //부서 조회
     	    $("#deptPopup").on("click", function() {
		     	var params = {
        	        searchType:"DEPT",
     	        	deptCd:"#deptCd",
     	        	deptNm:"#deptNm" 	  	        	        	         	    		
         	    }; 	        		        	        
        	    openPopup2(DEPT_ID, DEPT_URL, DEPT_ARGS, params);
         	 });	
	        
          	//리셋 버튼
    	    $(".btn_reset").click(function() {
    	    	let elements = ['asetNo', 'regDt', 'chrgr']
    	    	elements.forEach((item) => {$("#"+item).val("")});
    	    	$("#asetType1 option:eq(0)").prop("selected",true);
    	    	$('#asetType2').children('option:not(:first)').remove();
    	    	$('#asetType3').children('option:not(:first)').remove();	
    	    	$("#bizDeptCd").val("");
    	    	$("#bizDeptNm").val("");
    	    	$("#deptCd").val("");
    	    	$("#deptNm").val("");
    	    	$("#tagYn option:eq(0)").prop("selected",true);
    	    });    	        
	        
          	//조회 버튼 
    	    $(".btn_srch").on("click",function (){
    	    	$("#jsGrid").jsGrid("loadData");
	        });
          	//라벨발행 버튼 
    	    $(".btn_label").on("click",function (){
    	    	
	        });
          	//태그발행 버튼 
    	    $(".btn_tag").on("click",function (){
    	    	
	        });
          	
			//엔터키
    	    $(document).keypress(function(event){	    	    	
    	        var keycode = (event.keyCode ? event.keyCode : event.which);
    	        //console.log(event);
    	        if(keycode == '13'){
    	        	$("#jsGrid").jsGrid("loadData");
    	        }
    	    });
			
	        $("#pager").on("change", function() {
	            var page = parseInt($(this).val(), 10);
	            $("#jsGrid").find(".jsgrid-table").append("<tr class='jsgrid-row'></tr>");
	        });
			
		});
		
		
		function getCommCode(id, code, level, upperCodeId){				
			let url = "/common/comm/selectBox";
			let reqType = 'GET';
			$.commRequestSelectbox(url, reqType, id, code, level, upperCodeId);			
		}
		
		
	    function enterkey() {
	    	if (window.event.keyCode == 13) {
	    		$("#jsGrid").jsGrid("loadData");
	        }
	    }
	    
	    // 최근 생성된 실사년도 조회 
	    function getRecentInspYear(){
			let url = "/asset/insp/search/selectRecentInspYear";
			
  			let reqType = 'POST';
  			let data={"currentPage"  : 0,
    				  "numOfRows"    : 999}
  			$.commRequest(url, reqType, JSON.stringify(data))
  				.then((res) => {
  		            $("#inspYear").val(res.data[0].inspYear);
  		            
  				})
  				.catch((error) => {
  					console.log(error);
  				})
	    }
	    
		// 실사명 코드리스트
		function getInspNmList(){
			let url = "/asset/insp/search/selectInspNmList";
			
  			let reqType = 'POST';
  			let data={"currentPage"  : 0,
    				  "numOfRows"    : 999}
  			$.commRequest(url, reqType, JSON.stringify(data))
  				.then((res) => {
  					// option에 실사명 리스트 추가 
  					var str ="";
  		            $.each(res.data, function(i){
  		               str += '<option value="' + res.data[i].inspNo + '">' + res.data[i].inspNm + '</option>';
  		            })
  		            $("#inspNm").append(str);
  		            
  				})
  				.catch((error) => {
  					console.log(error);
  				})
		}
		
		// 실사부서 코드리스트
		function getInspDeptNm(){
			let url = "/asset/insp/search/selectInspDeptNmList";
			
  			let reqType = 'POST';
  			let data={
  				
  			}
  			$.commRequest(url, reqType, JSON.stringify(data))
  				.then((res) => {
  					// option에 실사명 리스트 추가 
  					var str ="";
  		            $.each(res.data, function(i){
  		               str += '<option value="' + res.data[i].deptCd + '">' + res.data[i].deptNm + '</option>';
  		            })
  		            $("#inspDept").append(str);
  		            
  				})
  				.catch((error) => {
  					console.log(error);
  				})
		}
		
    	// 셀렉트박스 코드 조회
    	function selectInspAsetCodeList(){
    		
    		var d = $.Deferred();
    		
            let url = "/asset/insp/manage/selectInspAsetCodeList"; 
			let reqType = 'GET';	
			let data = {
				"currentPage"  : 0,
				"numOfRows"    : 1, 
				"sortField"    : "",
				"sortOrder"    : ""
			}
			
			$.commRequest(url, reqType, data)
				.then((res) => {
					data = res.data;
					inspStusArr = data.inspStusArr;
					inspMtdArr = data.inspMtdArr;
					inspPtclArr = data.inspPtclArr;
					inspCmplYnArr = [{codeId:"Y", codeNm:"Y"},{codeId:"N", codeNm:"N"}];
					d.resolve({data : res});
					
				})
				.catch((error) => {
					console.log('[[#{screen.info.status.error.search}]]');
				});
    		
			return d.promise();
    	}
	 	
	 	// 텍스트 언더라인 함수
	 	function underlineCellRenderer(value, item) {
			return $("<td>").addClass("text-underline").text(value);
		}
		
	 	function jsGridLoad(){
			
	        $("#jsGrid").jsGrid({
	        	height: "550",
                width: "100%",
                filtering: false,
                editing: false,
                inserting: false,
                sorting: true,
                paging: true,
                sorter: "number",
                pageIndex:1,
                pageFirstText:'<a class="first"><img src="/images/common/btn_pn_first.gif"></img></a>',
                pagePrevText: '<a class="pre"><img src="/images/common/btn_pn_pre.gif"></img></a>',
                pageNextText: '<a class="next"><img src="/images/common/btn_pn_next.gif"></img></a>',
                pageLastText: '<a class="last"><img src="/images/common/btn_pn_last.gif"></img></a>',
                pagerFormat: "{first} {prev} {pages} {next} {last}",
                pagerContainer:null,
                pageLoading: true,
                pager: "#pager",
                pageSize: numOfRows,
                pageButtonCount: 5,
                loadonce: true,
                updateOnResize: true, 
	            rowClick: function(args) {
	            	//var $target = $(args.event.target); // 클릭한 셀 jquery object 
	            	//var columnIdx = $target.index(); // 클릭한 셀이 몇번째 컬럼인지 저장 
	            	//var inspNo =  args.item.inspNo// 해당 로우의 실사번호 
	            	jsGrid.Grid.prototype.rowClick.call(this, args);
	            },
	            pagerContainerClass: "paginate",
	            controller:  {
	                loadData: function(filter) {
	                    var d = $.Deferred();
	                    
	                    currentPage = filter.pageIndex; 
	                    let url = "/standard/tag/selectIssueTagList";
						let reqType = 'POST';	
						let data = {
            				"currentPage" : filter.pageIndex,
            				"numOfRows"   : numOfRows,
            				"asetNo" 	  : $("#asetNo").val(),
            				"regDt"  	  : $("#regDt").val(),
            				"asetType1"   : $("#asetType1 option:selected").val(),
            				"asetType2"   : $("#asetType2 option:selected").val(),
            				"asetType3"   : $("#asetType3 option:selected").val(),
            				"bizDeptCd"   : $("#bizDeptCd").val(),
            				"deptCd"      : $("#deptCd").val(),
            				"chrgr"       : $("#chrgr").val(),
            				"tagYn"    	  : $("#tagYn option:selected").val(),
            				"sortField"   : filter.sortField,
            				"sortOrder"   : filter.sortOrder
            			}
						
						$.commRequest(url, reqType, JSON.stringify(data))
							.then((res) => {
								condition = res.condition;
								$(".result").text("Results : " + res.condition.totalCount);
								d.resolve({data : res.data, itemsCount: res.condition.totalCount});
							})
							.catch((error) => {
								console.log('[[#{screen.info.status.error.search}]]');
							});						
	                    
	                    return d.promise();
	                },

           		},
	            fields: [
	                { name:"asetNo"		, type:"text", align:"center", width:"7%",title:"[[#{screen.text.aset.no}]]"},        //자산번호
	                { name:"asetType1"	, type:"text", align:"center", width:"7%",title:"[[#{screen.text.aset.type1}]]"},     //자산유형1
	                { name:"asetType2"	, type:"text", align:"center", width:"7%",title:"[[#{screen.text.aset.type2}]]"},     //자산유형2
	                { name:"asetType3"	, type:"text", align:"center", width:"7%",title:"[[#{screen.text.aset.type3}]]"},     //자산유형3
	                { name:"mftco"		, type:"text", align:"center", width:"7%",title:"[[#{screen.text.asset.mftco}]]"},    //메이커
	                { name:"model"		, type:"text", align:"center", width:"7%",title:"[[#{screen.text.asset.model}]]"},    //모델
	                { name:"sn"			, type:"text", align:"center", width:"7%",title:"[[#{screen.text.asset.sn}]]"},       //SN
	                { name:"bizDeptNm"	, type:"text", align:"center", width:"7%",title:"[[#{screen.text.asset.bizDeptCd}]]"},//사업부
	                { name:"deptNm"		, type:"text", align:"center", width:"7%",title:"[[#{screen.text.asset.deptCd}]]"},   //부서
	                { name:"chrgr"		, type:"text", align:"center", width:"7%",title:"[[#{screen.text.asset.chrgr}]]"},    //담당자
	                { name:"tagId"   	, type:"text", align:"center", width:"5%",title:"[[#{screen.text.tag.tagId}]]"  },    //태그ID
	                { name:"tagYn"    	, type:"text", align:"center", width:"5%",title:"[[#{screen.text.tag.tagYn}]]"},      // 태그발행여부
	                { name:"regDt" 		, type:"text", align:"center", width:"7%",title:"[[#{screen.text.tag.issueDt}]]"},    // 발행일자
	                { name:"regr"		, type:"text", align:"center", width:"5%",title:"[[#{screen.text.tag.issuer}]]"},     //발행자
	                { name:"tagHistory"	, type:"text", align:"center", width:"7%",title:"[[#{screen.text.tag.tagHistory}]]", cellRenderer:function(value, item){
	                	if(item.tagHistory > 0){
	                		return $("<td width='5%'>").addClass("text-underline").text("[[#{screen.text.aset.view}]]");
	                	}else{
	                		return $("<td width='5%'></td>");
	                	}
	                }}, //태깅이력
	            ]
	        });
	 	}
	 	
		</script>
	</th:block>
        
        
	<div layout:fragment="content">
	
		<!-- contents_head -->
		<div class="bc">Home &gt; <span th:text="${menuDesc}"></span></div>
		<h3><span th:text="${menuNm}"></span></h3>
		<!-- //contents_head -->	


		<!-- search -->
		<div class="srch_wrap single">
			<table class="srch_table">
				<colgroup>
					<col width="10%"/>
					<col width="20%"/>
					<col width="10%"/>
					<col width="20%"/>
					<col width="10%"/>
					<col width=""/>
				</colgroup>
				<tr> <!-- 자산번호 등록일자 -->
					<th>[[#{screen.text.aset.no}]]</th>
					<td><input type="text" id="asetNo" onkeyup="enterkey()" style="width:100%;"></td>
					<th>[[#{screen.text.comm.regdt}]]</th>
					<td>
						<div style='display:flex'><input type="date" id="regDt" style="width:100%"></div>
					</td>
					<th></th>
					<td></td>
				</tr>
				<tr> <!-- 자산유형 1,2,3 -->
					<th>[[#{screen.text.aset.type1}]]</th>
					<td>
						<select id="asetType1" style="width:100%;">
							<option value="">[[#{screen.text.comm.choice}]]</option>
						</select>
					</td>
					<th>[[#{screen.text.aset.type2}]]</th>
					<td>
						<select id="asetType2" style="width:100%;">
							<option value="">[[#{screen.text.comm.choice}]]</option>
						</select>
					</td>
					<th>[[#{screen.text.aset.type3}]]</th>
					<td>
						<select id="asetType3" style="width:100%;">
							<option value="">[[#{screen.text.comm.choice}]]</option>
						</select>
					</td>
				</tr>
				<tr> <!-- 사업부 부서 담당자 -->
					<th>[[#{screen.text.aset.bizDept}]]</th>
					<td>
						<input type="hidden" id="bizDeptCd"/>
						<input type="text" id="bizDeptNm" style="width:90%;" readonly/>							
						<a href="#" id="bizDeptPopup" >
							<img title="" class="ico_search" alt="Search" src="/images/common/ico_search.png">
						</a>
					</td>
					<th>[[#{screen.text.aset.dept}]]</th>
					<td>
						<input type="hidden" id="deptCd"/>
						<input type="text" id="deptNm" style="width:90%;" readonly/>							
						<a href="#" id="deptPopup" >
							<img title="" class="ico_search" alt="Search" src="/images/common/ico_search.png">
						</a>
					</td>
					<th>[[#{screen.text.aset.chrgr}]]</th>
					<td>
						<input type="text" id="chrgr" onkeyup="enterkey()" style="width:100%;">
					</td>
				</tr>
				<tr> <!-- 태그발행여부 -->
					<th>[[#{screen.text.tag.tagYn}]]</th>
					<td>
						<select id="tagYn" style="width:100%;">
							<option value="">[[#{screen.text.comm.choice}]]</option>
						</select>
					</td>
					<th></th>
					<td></td>
					<th></th>
					<td>
						<div class="button">
							<a href="#;" class="btn_reset">[[#{screen.btn.reset}]]</a>
							<a href="#;" class="btn_srch">[[#{screen.btn.search}]]</a>										
						</div>
					</td>
				</tr>
			</table>
		</div>
		<!-- search -->
		
		<!-- //search -->
		<div class="list_head">
				<div class="result">Results : 0,000</div>
				<!-- list_button -->
				<div class="button">
					<a class="btn_label">[[#{screen.text.tag.issueLabel}]]</a> <!-- 라벨발행 -->
					<a class="btn_tag">[[#{screen.text.tag.issueTag}]]</a> <!-- 태그발행 -->
				</div>
				<!-- list_button -->
		</div>
		<!-- list -->
		<!-- //search -->
		
		<!-- list -->
		<div id="jsGrid"></div>
		<input type="hidden" id="curr_Idx"/>
		<!-- //list -->
		
		<!-- insp create popup -->
		<!-- insp create popup -->
		
	</div>
        
</html>