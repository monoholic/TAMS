<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorator="layout/popup2">

	<head>
	    <title>[[#{screen.text.inv.screen.title3}]]</title>
	</head>
        
	<!-- css -->
	<th:block layout:fragment="css">
	    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="/css/jsgrid.css" />
		<link rel="stylesheet" href="/css/theme.css" />
		
	</th:block>
	
	<th:block layout:fragment="script">
		<script src="/js/jsgrid/db.js"></script>
	    <script src="/js/jsgrid/jsgrid.core.js"></script>
	    <script src="/js/jsgrid/jsgrid.load-indicator.js"></script>
	    <script src="/js/jsgrid/jsgrid.load-strategies.js"></script>
	    <script src="/js/jsgrid/jsgrid.sort-strategies.js"></script>
	    <script src="/js/jsgrid/jsgrid.field.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.text.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.number.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.select.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.checkbox.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.control.js"></script>	
		
	    <script>
	    
	    	let invData = $.commLoadSearchParams("invData");
	    	let menuId = "[[${menuId}]]";

			let gridData = [];
	        let selectedItems = [];
	        
		    $(function(){
		    	
		    	//헤더 항목값 설정
				$("#invNo").html(invData.invNo);		
				$("#invTtl").html(invData.invTtl);
				$("#poNo").html(invData.poNo);
				$("#mfgdNm").html(invData.mfgdNm);
				$("#qty").html(invData.qty);
				$("#invBizDeptNm").html(invData.uppDeptNm);
				$("#invDeptNm").html(invData.deptNm);
				$("#invReqr").html(invData.invReqr);		    	
		    	
		    	
		        $("#jsGrid").jsGrid({
		        	height: "400",
	                width: "100%",
	                autoload: true,
	                editing: true,
	                data: gridData, 
		            deleteConfirm: function(item) {
		                return "\""+item.menuNm+"("+menuId+")"+"\""+ "을 삭제 하시겠습니까?";
		            },
		            controller:  {
		                loadData: function(filter) {
		                },
		                insertItem: function(item) {
		                },		                		                
	            	},
		            fields: [{ name : "chk"
		               	     , align: "center"
		                	 , width: 20
		                	 , title: ""
		                	 , editing: false
		                	 , sorting: false
		                	 , filtering: false
		                	 , itemTemplate: function(value, item) {
		                       return $("<input>").attr("type", "checkbox").attr("class","singleCheckbox").attr("id", function(){
		                    	   
		                    	  return "checkbox" + $("#jsGrid").jsGrid("option", "data").findIndex(arr => arr.poNo == item.poNo);
		                       })
		                       .attr("checked", function(){
		                    	  return value || item.checked;
		                       })
		                       .on("change", function () {
		  					  	 $(this).is(":checked") ? selectItem(item) : unselectItem(item);
		  					  	 });
		            		   }
		                	 , headerTemplate : function ()  { 
							  	 return  $("<input>").attr("type", "checkbox").attr("id","selectAllCheckbox")
			                     .on("change", function (item) {
			            	    	if(this.checked) { 
				            	            $('.singleCheckbox').each(function(i) {
			            	            	$("#checkbox" + i).prop("checked", true).change();
			            	            });
			            	        }else {
			            	            $('.singleCheckbox').each(function(i) { 
			            	            	$("#checkbox" + i).prop("checked", false).change();
			            	            });  
			            	        }
			    				   });
						 	 },
		                },
		            	{ name: "asetNo"     , type: "text", width: 70, align: "center", editing: false, title: "[[#{screen.text.aset.no}]]"},
		                { name: "asetTypeNm1", type: "text", width: 80, align: "left"  , editing: false, title: "[[#{screen.text.aset.type1}]]"},
		                { name: "asetTypeNm2", type: "text", width: 80, align: "left"  , editing: false, title: "[[#{screen.text.aset.type2}]]"},
		                { name: "asetTypeNm3", type: "text", width: 80, align: "left"  , editing: false, title: "[[#{screen.text.aset.type3}]]"},
		                { name: "mftco"   	 , type: "text", width: 70, align: "left"  , editing: false, title: "[[#{screen.text.aset.mftco}]]"},
		                { name: "model"	   	 , type: "text", width: 70, align: "left"  , editing: false, title: "[[#{screen.text.aset.md}]]"},
		                { name: "sn"    	 , type: "text", width: 80, align: "left"  , editing: false, title: "[[#{screen.text.aset.sn}]]"},
		                { name: "bizDeptNm"  , type: "text", width: 80, align: "left"  , editing: false, title: "[[#{screen.text.asset.bizDeptCd}]]"},
		                { name: "deptNm"   	 , type: "text", width: 80, align: "left"  , editing: false, title: "[[#{screen.text.asset.deptCd}]]"},
		                { name: "chrgr"  	 , type: "text", width: 60, align: "center", editing: false, title: "[[#{screen.text.asset.chrgr}]]"},
		                { name: "asetQty"  	 , type: "text", width: 50, align: "left"  , title: "[[#{screen.text.comm.qty}]]"},		                
		                { name: "asetType1"  , type: "text", visible:false},
		                { name: "asetType2"  , type: "text", visible:false},
		                { name: "asetType3"	 , type: "text", visible:false},		                
		                { name: "bizDeptCd"  , type: "text", visible:false},
		                { name: "deptCd"   	 , type: "text", visible:false},		                
		                ],
		        	onItemUpdating: function(args){
		        		console.log(args);
		        		console.log('onItemUpdating called....');
		        	}		                
		        });
		    	
			    var selectItem = function(item) {
			    	
			    	if(!selectedItems.includes(item)){
				    	selectedItems.push(item);
			    	}
			    	
				    if($(".singleCheckbox").length == $(".singleCheckbox:checked").length) {
		             $("#selectAllCheckbox").prop("checked", true);
		            } else {
		                $("#selectAllCheckbox").prop("checked", false);
		            }
				};
			     
			    var unselectItem = function(item) {
			    	
				    selectedItems = $.grep(selectedItems, function(i) {
				    return i !== item;
				    });
				    
				    if(selectedItems.length == 0) {
				    	$('#selectAllCheckbox').attr('checked', false);
				    }
				    if($(".singleCheckbox").length == $(".singleCheckbox:checked").length) {
		             	$("#selectAllCheckbox").prop("checked", true);
			        } else {
			            $("#selectAllCheckbox").prop("checked", false);
			        }
			    };		    	

			    
			    /*------------------------ Event ------------------------*/
		        //자산선택
	    	    $("#addAsset").on("click", function() { 
	    	        // 팝업 호출 url
	    	        var url = "/common/popup/asetMasPopup";
	    	        var args = {
	    	        	width  : 1350,
	    	    	    height : 600,
		    	    	pheight: window.opener.innerHeight,
		    	    	pwidth : window.opener.innerWidth,	  	     	    			    	    	    
	    	        };
	    	        
	    	        var param = {
	   	        		id : "reqStus",
	   	    	        value : "20"
	    	        };
	    	        
	    	        openPopup("AsetMasPopup", url, args, param);
	    	    });		        
			    
			    
			    
		        //팝업종료
				$(".pop_close").on("click",function(){ 
					window.close();
				});	
	            	 	
    		});
	    
		    //자산선택 팝업 Callback function.
	    	function selectAsetList(obj) {
	    		obj.forEach(row => {
	    			
	    			//기존 선택한 자산 확인.
	    			
		    		$("#jsGrid").jsGrid("insertItem", row);	
	    		});	    		
	    			    		
	    		/*
	    		$.each(asetList, function(idx, el){
	    			asetNoChk.push(el.asetNo);
	    		});
	    		
	    		$.each(obj, function (idx, el){
	    			if(!asetNoChk.includes(el.asetNo)) {
	    				asetList.push(el);
	    			}
	    			else
	    				alert("[[#{screen.info.status.error.modify.dup.asset}]]");
	    		});
	    		jsGridLoad();
	    		*/
			}
		    
	    </script>	
	</th:block>

	<div layout:fragment="content">

		<!-- container -->
		<div id="container-pop">
		
			<!-- contents -->
			<div id="contents">
		
				<!-- contents_head -->
				<h3>[[#{screen.text.inv.screen.title3}]]<a href="#;" class="pop_close" title="닫기">[[#{screen.text.comm.close}]]</a></h3>				
				<!-- //contents_head -->
				
				<!-- detail_table -->
				<table class="detail_table form_s">
					<colgroup>
					<col style="width:12%" />
					<col style="width:20%" />
					<col style="width:12%" />
					<col style="width:20%" />
					<col style="width:12%" />
					<col />
					</colgroup>
					<tr>
						<th>[[#{screen.text.inv.no}]]</th>
						<td><span id="invNo"></span></td>
						<th>[[#{screen.text.inv.ttl}]]</th>
						<td colspan="3"><span id="invTtl"></span></td>

					</tr>
					<tr>
						<th>[[#{screen.text.po.no}]]</th>
						<td><span id="poNo"></span></td>					
						<th>[[#{screen.text.po.mfgdnm}]]</th>
						<td><span id="mfgdNm"></span></td>
						<th>[[#{screen.text.comm.qty}]]</th>
						<td><span id="qty"></span></td>

					</tr>
					<tr>
						<th>[[#{screen.text.asset.bizDeptCd}]]</th>
						<td><span id="invBizDeptNm"></span></td>					
						<th>[[#{screen.text.asset.deptCd}]]</th>
						<td><span id="invDeptNm"></span></td>
						<th>[[#{screen.text.asset.chrgr}]]</th>
						<td><span id="invReqr"></span></td>
					</tr>
				</table>
				<!-- //detail_table -->				
				
				<p class="space10"></p>		
		
				<!-- list -->
				<div class="list_wrap">
				
					<!-- list_head -->
					<div class="list_head">
						<div class="result">Totals : 0,000</div>
						<!-- list_button -->
						<div class="button">
							<a id="addAsset" class="btn_sel">자산추가</a>
							<a id="save" class="btn_sel">저장</a>
							<a id="del" class="btn_sel">삭제</a>
						</div>
						<!-- list_button -->
					</div>
					<!-- //list_head -->
									
					<div id="jsGrid"></div>				
				</div>
				<!-- //list -->
			</div>		
			<!-- //contents -->
		</div>				
		<!-- //container -->
	</div>
</html>