<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorator="layout/default">

	<head>
	    <title>[[#{screen.text.inv.screen.title2}]]</title>
	</head>
        
	<!-- css -->
	<th:block layout:fragment="css">
	    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="/css/jsgrid.css" />
		<link rel="stylesheet" href="/css/theme.css" />
		
	</th:block>
	
	<th:block layout:fragment="script">
		<script src="/js/jsgrid/db.js"></script>
	    <script src="/js/jsgrid/jsgrid.core.js"></script>
	    <script src="/js/jsgrid/jsgrid.load-indicator.js"></script>
	    <script src="/js/jsgrid/jsgrid.load-strategies.js"></script>
	    <script src="/js/jsgrid/jsgrid.sort-strategies.js"></script>
	    <script src="/js/jsgrid/jsgrid.field.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.text.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.number.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.select.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.checkbox.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.control.js"></script>	
		
	    <script>
	    
	    // 공통코드(자산유형 1레벨 출력)
	    let numOfRows = 15;
        var selectedItems = [];
	 	var insertedItems = [];
	 	var updatedItems = [];
	 	
	 	var invData = {};
	 	
	    $(function(){
	        $("#jsGrid").jsGrid({
	        	height: "400",
                width: "100%",
                filtering: false,
                editing: false,
                inserting: true,
                sorting: true,
                paging: true,
                sorter: "number",
                pageIndex:1,
                pageFirstText:'<a class="first"><img src="/images/common/btn_pn_first.gif"></img></a>',
                pagePrevText: '<a class="pre"><img src="/images/common/btn_pn_pre.gif"></img></a>',
                pageNextText: '<a class="next"><img src="/images/common/btn_pn_next.gif"></img></a>',
                pageLastText: '<a class="last"><img src="/images/common/btn_pn_last.gif"></img></a>',
                pagerFormat: "{first} {prev} {pages} {next} {last}",
                pagerContainer:null,
                pageLoading: true,
                pager: "#pager",
                autoload: true,
                pageSize: numOfRows,
                pageButtonCount: 5,
                loadonce: true,
                updateOnResize: true, 
	            pagerContainerClass: "paginate",
	            deleteConfirm: function(item) {
	                return "\""+item.menuNm+"("+menuId+")"+"\""+ "을 삭제 하시겠습니까?";
	            },
	            controller:  {
	                loadData: function(filter) {
	                    var d = $.Deferred();
	                    
	                    let url = "/asset/regist/invest/regAset/regAsetList";
						let reqType = 'POST';
						let params = getParams();
	                    params.sortField = filter.sortField;
	                    params.sortOrder = filter.sortOrder;
	                    
						$.commRequest(url, reqType, JSON.stringify(params))
							.then((res) => {
								console.log(res);
								$(".result").text("Totals : " + res.condition.totalCount);
								d.resolve({data : res.data, itemsCount: res.condition.totalCount});
								
								$("#invNo").val(res.data2[0].invNo);
								$("#invTtl").val(res.data2[0].invTtl);
								$("#poNo").val(res.data2[0].poNo);
								$("#mfgdNm").val(res.data2[0].mfgdNm);
								$("#qty").val(res.data2[0].qty);
								$("#uppDeptNm").val(res.data2[0].uppDeptNm);
								$("#deptNm").val(res.data2[0].deptNm);
								$("#invReqr").val(res.data2[0].invReqr);
								
								$("#all").val(res.data2[0].qty);
								$("#cpt").val(res.data2[0].asetQty);
								$("#icpt").val(res.data2[0].noAsetQty);
								
								invData = res.data2[0];
							})
							.catch((error) => {
								console.log('메뉴조회 실패!!');
							});						
	                    
	                    return d.promise();
	                },
            },
	            fields: [
	            	{ name: "asetNo"    	, type: "text"	, width: 80 	, align: "left"  , title: "[[#{screen.text.aset.no}]]"        },
	                { name: "asetType1"   	, type: "text"	, width: 70		, align: "left"  , title: "[[#{screen.text.aset.type1}]]"     },
	                { name: "asetType2"   	, type: "text"	, width: 70		, align: "left"  , title: "[[#{screen.text.aset.type2}]]"     },
	                { name: "asetType3"	   	, type: "text"	, width: 70		, align: "left"  , title: "[[#{screen.text.aset.type3}]]"     },
	                { name: "mftco"   		, type: "text"	, width: 50		, align: "left"  , title: "[[#{screen.text.aset.mftco}]]" 	  },
	                { name: "model"	   		, type: "text"	, width: 70 	, align: "left"  , title: "[[#{screen.text.aset.md}]]"        },
	                { name: "sn"    		, type: "text"	, width: 80		, align: "left"  , title: "[[#{screen.text.aset.sn}]]"        },
	                { name: "uppDeptNm"   	, type: "text"	, width: 70		, align: "left"  , title: "[[#{screen.text.asset.bizDeptCd}]]"},
	                { name: "deptNm"   		, type: "text"	, width: 70		, align: "left"  , title: "[[#{screen.text.asset.deptCd}]]"   },
	                { name: "chrgr"   		, type: "text"	, width: 50		, align: "left"  , title: "[[#{screen.text.asset.chrgr}]]"    },
	                { name: "tagYn"			, type: "text"	, width: 55		, align: "left"  , title: "[[#{screen.text.aset.tagYn}]]"     },
	                { name: "asetStus"		, type: "text"	, width: 55		, align: "left"  , title: "[[#{screen.text.aset.asetStus}]]"  },
	            ]
	        });
	        
    	    $(".btn_srch").on("click",function (){
    	    	if (validationCheck() == '202') {
	    	   		$("#jsGrid").jsGrid().trigger("loadData");
    	    	}
	        });
          	
			// 신규자산 등록
    	    $("#newAsetRegist").on("click", function() { 
    	        // 팝업 호출 url
    	        var url = "/asset/regist/invest/newAsetReg";
    	        var popId = "newAsetRegist";
    	        var args = {};
    	        args.width = 1350;
    	        args.height = 650;
    	        args.fullscreen = "no";
    	        args.resizable = "no";
    	        
    	        var param = {};
    	        param.menuId = $.commLoadSearchParams("menuId");
    	        param.poNo = "[[${poNo}]]";
    	        
    	        $.commSaveSearchParams("invData", invData);
    	        
    	        openPopup2(popId, url, args, param);
    	    });
			
			// 개조자산 선택
    	    $("#remodelAsetRegist").on("click", function() { 
    	        // 팝업 호출 url
    	        var url = "/asset/regist/invest/remodelAsetReg";
    	        var popId = "remodelAsetRegist";
    	        var args = {};
    	        args.width = 1350;
    	        args.height = 650;
    	        args.fullscreen = "no";
    	        args.resizable = "no";
    	        
    	        var param = {};
    	        param.id    = "poNo";
    	        param.value = "[[${poNo}]]";
    	        
    	        $.commSaveSearchParams("invData", invData);
    	        
    	        openPopup(popId, url, args);
    	    });
			
			// 일괄 업로드 팝업 
    	    $("#openRegAsetPopup").on("click", function() { 
    	        // 팝업 호출 url
    	        var url = "/asset/regist/invest/popup/regAsetUploadPopup";
    	        var popId = "regAsetPopup";
    	        var args = {};
    	        args.width = 1200;
    	        args.height = 710;
    	        args.fullscreen = "no";
    	        args.resizable = "no";
    	        
    	        openPopup(popId, url, args);
    	    });
     	    
			// 엑셀다운
     	    $("#excelDown").on("click",function() {
     	    	
			       	event.preventDefault();
	                let url = "/asset/regist/invest/regAsetListExcel";
					
					var $form = $('<form id="downForm"></form>'); 
						$form.attr('action', url); 
						$form.attr('method', 'post'); 
						$form.attr('target', '_self'); 
						
					var inputStr = $('<input type="hidden" value="'+ "[[${poNo}]]" + '" name="poNo">');
						$form.append(inputStr);
						inputStr = $('<input type="hidden" value="'+ $("#jsGrid").jsGrid("option", "pageIndex") + '" name="currentPage">');
						$form.append(inputStr);
						inputStr = $('<input type="hidden" value="'+ numOfRows + '" name="numOfRows">');
						$form.append(inputStr);
						
						$form.appendTo('body'); 
						$form.submit();
						
			});
     	    
     	    // 뒤로가기
     	    $("#investBack").on("click",function() {
     	    	
			       	event.preventDefault();
			       	
	                let url = "/asset/regist/invest/investReg";
					
					var $form = $('<form></form>'); 
						$form.attr('action', url); 
						$form.attr('method', 'post'); 
						$form.attr('target', '_self'); 
						inputStr = $('<input type="hidden" value="'+ $.commLoadSearchParams("menuId") + '" name="menuId">');	
						$form.append(inputStr);
						inputStr = $('<input type="hidden" value="'+ $.commLoadSearchParams("menuNm") + '" name="menuNm">');	
						$form.append(inputStr);
						inputStr = $('<input type="hidden" value="'+ $.commLoadSearchParams("menuDesc") + '" name="menuDesc">');	
						$form.append(inputStr);
						$form.appendTo('body'); 
						$form.submit();
						
			});
    	});
	    
	    function returnResult(item) {
			opener.selectAsetList(item);
			window.close();
	    }
	    
        function getParams(){
            return {
                    "currentPage": $("#jsGrid").jsGrid("option", "pageIndex"),
    				"numOfRows"    : numOfRows,
    				"poNo"         : "[[${poNo}]]"      
                 }
         }
        
	    </script>	
	</th:block>

	<div layout:fragment="content">
	<!-- [D] 현재 팝업창 크기는 600*600 입니다. 콘텐츠에 따라서 크기를 변경하여 주십시오.-->
			<!-- contents_head -->
			<!-- <div class="bc">Home &gt; <span th:text="${menuDesc}"></span></div> -->
			<h3><span>등록자산목록</span></h3>
			<div class="bbc">						
				<div class="button">
					<a class="btn_sel" id="investBack">뒤로가기</a>
				</div>
			</div>
			<!-- //contents_head -->
			<!-- contents -->
			<div id="contents">
				<div class="srch_wrap">
					<!-- search_form -->
					<div class="srch_wrap single">
						<table class="srch_table">
							<colgroup>
								<col style="width:5%"/>
								<col style="width:10%"/>
								<col style="width:15%"/>
								<col style="width:5%"/>
								<col style="width:10%"/>
								<col style="width:15%"/>
								<col style="width:5%"/>
								<col style="width:10%"/>
								<col style="width:15%"/>
							</colgroup>
							<tr>
								<td></td>
								<th style="text-align:center;">[[#{screen.text.inv.no}]]</th>
								<td><input type="text" id="invNo" onkeyup="enterkey()" style="width:100%;"></td>
								<td></td>
								<th style="text-align:center;">[[#{screen.text.inv.ttl}]]</th>
								<td><input type="text" id="invTtl" onkeyup="enterkey()" style="width:100%;"></td>
								<td></td>
								<th style="text-align:center;">[[#{screen.text.po.no}]]</th>
								<td><input type="text" id="poNo" onkeyup="enterkey()" style="width:100%;"></td>
								<td></td>
							</tr>
							<tr>
								<td></td>
								<th style="text-align:center;">[[#{screen.text.po.mfgdnm}]]</th>
								<td><input type="text" id="mfgdNm" onkeyup="enterkey()" style="width:100%;"></td>
								<td></td>
								<th style="text-align:center;">[[#{screen.text.comm.qty}]]</th>
								<td><input type="text" id="qty" onkeyup="enterkey()" style="width:100%;"></td>
								<td></td>
								<th style="text-align:center;">[[#{screen.text.asset.bizDeptCd}]]</th>
                                <td><input type="text" id="uppDeptNm" onkeyup="enterkey()" style="width:100%;"></td>
								<td></td>
							</tr>
							<tr>
								<td></td>
								<th style="text-align:center;">[[#{screen.text.asset.deptCd}]]</th>
                                <td><input type="text" id="deptNm" onkeyup="enterkey()" style="width:100%;"></td>
								<td></td>
								<th style="text-align:center;">[[#{screen.text.asset.chrgr}]]</th>
                                <td><input type="text" id="invReqr" onkeyup="enterkey()" style="width:100%;"></td>
								<td></td>
								<th style="text-align:center;">전체/완료/미완료</th>
								<td>
								    <div id="asetStatusQty">
										<input type="text" id="all" onkeyup="enterkey()" style="width:100%;">
										<input type="text" id="cpt" onkeyup="enterkey()" style="width:100%;">
										<input type="text" id="icpt" onkeyup="enterkey()" style="width:100%;">
									</div>
								</td>
							</tr>
						</table>
					 </div>
				</div>
					<div class="list_head">
						<div class="result">Totals : 0,000</div>
						<div class="button">
							<a class="btn_sel" id="newAsetRegist">신규자산 등록</a>
							<a class="btn_sel" id="remodelAsetRegist">개조자산 선택</a>
							<a class="btn_sel" id="openRegAsetPopup">일괄 업로드</a>
							<a class="btn_sel" id="excelDown">엑셀 다운로드</a>
						</div>
						<!-- list_button -->
					</div>
					<div id="jsGrid"></div>
			</div>
			
			<div id="excelDownTarget"></div>
		</div>			
</html>