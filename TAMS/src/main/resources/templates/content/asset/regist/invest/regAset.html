<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorator="layout/default">

	<head>
	    <title>[[#{screen.text.inv.screen.title2}]]</title>
	</head>
        
	<!-- css -->
	<th:block layout:fragment="css">	
	    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="/css/theme.css" />
		<link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.0.8/css/tabulator.min.css" rel="stylesheet"> 
	</th:block>   
	
	<th:block layout:fragment="script">
		<script type="text/javascript" src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
		<script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.0.7/dist/js/tabulator.min.js"></script>
		
	    <script>

	    	let grid; 		 	
		 	let invData = {};
		 	
		    $(function(){
		    	
		    	const SCREEN_NM = "INVEST_REG_RIST";   
		    	let loadParams = $.commLoadSearchParams(SCREEN_NM);
		    	
				grid = new Tabulator("#data-table", {
				 	locale:true,
				    langs: $.commGridLocalization(),								
				 	height:"95%",		
				 	maxHeight:"100%",				 	
				 	layout:"fitColumns",
				 	movableColumns:true,
				 	pagination:true,
				 	paginationMode:"remote",
				 	ajaxURL:"/asset/regist/invest/regAset/regAsetList",	 
				 	ajaxParams: getParams(),
				 	paginationSize:20,				    
				 	paginationSizeSelector:[20, 50, 100, 500],			
				 	dataSendParams:{
				        "page":"currentPage",
				        "size":"numOfRows"
				    } ,							    
				 	placeholder:"No Data Set",				 	
				 	ajaxResponse:function(url, params, res){						
						$(".result").text("Totals : " + res.condition.totalCount);						
						$("#invNo").val(res.data2[0].invNo);
						$("#invTtl").val(res.data2[0].invTtl);
						$("#poNo").val(res.data2[0].poNo);
						$("#mfgdNm").val(res.data2[0].mfgdNm);
						$("#qty").val(res.data2[0].qty);
						$("#uppDeptNm").val(res.data2[0].uppDeptNm);
						$("#deptNm").val(res.data2[0].deptNm);
						$("#invReqr").val(res.data2[0].invReqr);						
						$("#all").val(res.data2[0].qty);
						$("#cpt").val(res.data2[0].asetQty);
						$("#icpt").val(res.data2[0].noAsetQty);
						
						invData = res.data2[0];
						
				 		return res;
				 	},					 	
				 	columns:[ 
					 	{title:"[[#{screen.text.aset.no}]]"		 	, field:"asetNo"	, hozAlign:"center", headerHozAlign:"center"},
					 	{title:"[[#{screen.text.aset.type1}]]"		, field:"asetType1"	, hozAlign:"left"  , headerHozAlign:"center"},
					 	{title:"[[#{screen.text.aset.type2}]]"		, field:"asetType2" , hozAlign:"left"  , headerHozAlign:"center"},
					 	{title:"[[#{screen.text.aset.type3}]]"	 	, field:"asetType3"	, hozAlign:"left"  , headerHozAlign:"center"},
					 	{title:"[[#{screen.text.aset.mftco}]]"	 	, field:"mftco"		, hozAlign:"left"  , headerHozAlign:"center"},
					 	{title:"[[#{screen.text.aset.md}]]"	 	 	, field:"model"		, hozAlign:"left"  , headerHozAlign:"center"},
					 	{title:"[[#{screen.text.aset.sn}]]"	 	   	, field:"sn"		, hozAlign:"left"  , headerHozAlign:"center"},
					 	{title:"[[#{screen.text.asset.bizDeptCd}]]"	, field:"uppDeptNm"	, hozAlign:"left"  , headerHozAlign:"center"},
					 	{title:"[[#{screen.text.asset.deptCd}]]"	, field:"deptNm"	, hozAlign:"left"  , headerHozAlign:"center"},
					 	{title:"[[#{screen.text.asset.chrgr}]]"	 	, field:"chrgr"		, hozAlign:"left"  , headerHozAlign:"center"},
					 	{title:"[[#{screen.text.aset.tagYn}]]"		, field:"tagYn"		, hozAlign:"center", headerHozAlign:"center"},
					 	{title:"[[#{screen.text.aset.asetStus}]]"	, field:"asetStus"	, hozAlign:"center", headerHozAlign:"center"},
				 	],
				});						
		    		    
				/*------------- Grid Events -------------*/
				//row click
				grid.on("rowClick", function(e, row){	
	    	        var params = {
	        	        	menuId  : loadParams.menuId,
	        	        	assetNo : row.getData().asetNo,
	        	        }; 										
					openNewAssetPopup(params);
				});	
				
				
				/*------------- Button Events -------------*/
				//신규자산
	    	    $("#newAsetRegist").on("click", function() {	    	    	
	    	    	
	    	    	if(!checkRegistQty()) return;	    	    	
	    	    	
	    	    	if(loadParams.newYn == "N"){
	    	    		alert("[[#{screen.info.status.error.inv.modified.asset.can.be}]]");
	    	    		return;
	    	    	}	 	   	    	    	
	    	        var params = {
	        	        	menuId  : loadParams.menuId,
	        	        	assetNo : "",
	        	        }; 	    	    	
	    	    	openNewAssetPopup(params);
	    	    });
				
				//개조자산
	    	    $("#remodelAsetRegist").on("click", function() { 
	    	    	
	    	    	if(!checkRegistQty()) return;	    	    	
	    	    	
	    	    	if(loadParams.newYn == "Y"){
	    	    		alert("[[#{screen.info.status.error.inv.new.asset.can.be}]]");
	    	    		return;
	    	    	}	    	    	

	    	        var url = "/asset/regist/invest/remodelAsetReg";
	    	        var args = {width:1350, height:650};
	    	        var param = {
	    	        	id    : "poNo",
	    	        	value : "[[${poNo}]]",
	    	        };
	    	        
	    	        $.commSaveSearchParams("invData", invData);	    	        
	    	        openPopup("remodelAsetRegist", url, args);
	    	    });
				
				// 일괄 업로드 팝업 
	    	    $("#openRegAsetPopup").on("click", function() { 
	    	        // 팝업 호출 url
	    	        var url = "/asset/regist/invest/popup/regAsetUploadPopup";
	    	        var args = {width:1200, height:710};	    	        
	    	        openPopup("regAsetPopup", url, args);
	    	    });
	     	    
				// 엑셀다운
	     	    $("#excelDown").on("click",function() {	     	    	
	     	    	grid.download("xlsx", "RegistAsset.xlsx", {sheetName:"등록자산"});							
				});
	     	    
	     	    // 뒤로가기
	     	    $("#investBack").on("click",function() {
	     	    	
				       	event.preventDefault();
				       	
		                let url = "/asset/regist/invest/investReg";
						
						var $form = $('<form></form>'); 
							$form.attr('action', url); 
							$form.attr('method', 'post'); 
							$form.attr('target', '_self'); 
							inputStr = $('<input type="hidden" value="'+ loadParams.menuId + '" name="menuId">');	
							$form.append(inputStr);
							inputStr = $('<input type="hidden" value="'+ loadParams.menuNm + '" name="menuNm">');	
							$form.append(inputStr);
							inputStr = $('<input type="hidden" value="'+ loadParams.menuDesc + '" name="menuDesc">');	
							$form.append(inputStr);
							inputStr = $('<input type="hidden" value="Y" name="loadParams">');	
							$form.append(inputStr);							
							$form.appendTo('body'); 
							$form.submit();
							
				});
	    	});
		    
		    function returnResult(item) {
				opener.selectAsetList(item);
				window.close();
		    }
		    
	        function getParams(){
	            return {"poNo" : "[[${poNo}]]"}
	        }  
	        
	        function search(){
	        	grid.replaceData();
	        }
	        
	        function checkRegistQty(){	        	
    	    	if($("#cpt").val() == $("#all").val()){
    	    		alert("[[#{screen.info.status.error.inv.regist.completed}]]");
    	    		return false;	    	    		
    	    	}
				return true;
	        }
	        
	        function openNewAssetPopup(params){
    	        var url = "/asset/regist/invest/newAsetReg";
    	        var args = {width:1200, height:700};
    	        $.commSaveSearchParams("invData", invData);	    	        
    	        openPopup2("newAsetRegist", url, args, params);	        	
	        }
	        
	    </script>	
	</th:block>

	<div layout:fragment="content">
		<!-- contents_head -->
		<!-- <div class="bc">Home &gt; <span th:text="${menuDesc}"></span></div> -->
		<h3><span>등록자산목록</span></h3>
		<div class="bbc">						
			<div class="button">
				<a class="btn_sel" id="investBack">뒤로가기</a>
			</div>
		</div>
		<!-- //contents_head -->			
		<!-- search -->
		<div class="srch_wrap">
			<!-- search_form -->
			<div class="srch_form">
				<table class="srch_table">
					<colgroup>
						<col width="10%"/>
						<col width="20%"/>
						<col width="10%"/>
						<col width="20%"/>
						<col width="10%"/>
						<col width="20%"/>
					</colgroup>
					<tr>
						<th>[[#{screen.text.inv.no}]]</th>
						<td><input type="text" id="invNo" onkeyup="enterkey()" style="width:100%;" readOnly></td>
						<th>[[#{screen.text.inv.ttl}]]</th>
						<td><input type="text" id="invTtl" onkeyup="enterkey()" style="width:100%;" readOnly></td>
						<th>[[#{screen.text.po.no}]]</th>
						<td><input type="text" id="poNo" onkeyup="enterkey()" style="width:100%;" readOnly></td>
					</tr>
					<tr>
						<th>[[#{screen.text.po.mfgdnm}]]</th>
						<td><input type="text" id="mfgdNm" onkeyup="enterkey()" style="width:100%;" readOnly></td>
						<th>[[#{screen.text.comm.qty}]]</th>
						<td><input type="text" id="qty" onkeyup="enterkey()" style="width:100%;" readOnly></td>
						<th>[[#{screen.text.asset.bizDeptCd}]]</th>
						<td><input type="text" id="uppDeptNm" onkeyup="enterkey()" style="width:100%;" readOnly></td>
					</tr>
					<tr>
						<th>[[#{screen.text.asset.deptCd}]]</th>
						<td><input type="text" id="deptNm" onkeyup="enterkey()" style="width:100%;" readOnly></td>
						<th>[[#{screen.text.asset.chrgr}]]</th>
						<td><input type="text" id="invReqr" onkeyup="enterkey()" style="width:100%;" readOnly></td>
						<th>[[#{screen.text.inv.reg.status}]]</th>
						<td>
						    <div id="asetStatusQty">
								<input type="text" id="all" onkeyup="enterkey()" style="width:100%;" readOnly>
								<input type="text" id="cpt" onkeyup="enterkey()" style="width:100%;" readOnly>
								<input type="text" id="icpt" onkeyup="enterkey()" style="width:100%;" readOnly>
							</div>
						</td>							
					</tr>
				</table>
			</div>
			<!-- //search_form -->
		</div>
		<!-- //search -->			

		<div class="list_head">
			<div class="result">Totals : 0,000</div>
			<div class="button">
				<a class="btn_sel" id="newAsetRegist">[[#{screen.text.inv.new.asset}]]</a>
				<a class="btn_sel" id="remodelAsetRegist">[[#{screen.text.inv.modified.asset}]]</a>
				<a class="btn_sel" id="openRegAsetPopup">[[#{screen.text.inv.batch.upload}]]</a>
				<a class="btn_sel" id="excelDown">[[#{screen.btn.excel}]]</a>
			</div>
			<!-- list_button -->
		</div>
		<div id="data-table"></div>
	</div>			
</html>