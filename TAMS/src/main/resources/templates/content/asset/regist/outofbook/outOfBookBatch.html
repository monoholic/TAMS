<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorator="layout/popup2">

	<head>
	    <title>[[#{screen.text.outofbook.screen.title2}]]</title>
	</head>
        
	<!-- css -->
	<th:block layout:fragment="css">	
	    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="/css/theme.css" />
		<link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.0.8/css/tabulator.min.css" rel="stylesheet"> 
	</th:block>  

	 <th:block layout:fragment="script">
		<script type="text/javascript" src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
		<script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.0.7/dist/js/tabulator.min.js"></script>
	
		<script>

    		let grid;		
		    let excelUpData = new FormData();
		    
			$(function(){
				
				
				grid = new Tabulator("#data-table", {
				 	locale:true,
				    langs: $.commGridLocalization(),								
				 	height:"410",
				 	layout:"fitDataStretch",
				 	movableColumns:true,
				 	placeholder:"No Data Set",	
				 	index:"asetNo",				 	
				 	columns:[
				 		{formatter:"rownum", hozAlign:"center", width:40, headerSort:false},			 		
						{ title: "[[#{screen.text.inv.mng.no}]]"			, field: "invNo"	, hozAlign: "center", headerHozAlign:"center"},
						{ title: "[[#{screen.text.inv.mng.nm}]]"			, field: "invTtl"	, hozAlign: "left"  , headerHozAlign:"center"},
			            { title: "[[#{screen.text.inv.mng.dt}]]"			, field: "invDt"   	, hozAlign: "center", headerHozAlign:"center"},
						{ title: "[[#{screen.text.inv.mng.qty}]]"			, field: "invQty"	, hozAlign: "right" , headerHozAlign:"center"},
			            { title: "[[#{screen.text.inv.mng.amt}]]"			, field: "invAmt"	, hozAlign: "right" , headerHozAlign:"center"},
			            { title: "[[#{screen.text.inv.mng.financial.year}]]", field: "actgYear"	, hozAlign: "center", headerHozAlign:"center"},
			            { title: "[[#{screen.text.inv.mng.po.no}]]"			, field: "poNo"		, hozAlign: "center", headerHozAlign:"center"},
						{ title: "[[#{screen.text.inv.mng.item.nm}]]"		, field: "mfgdNm"	, hozAlign: "left"  , headerHozAlign:"center"},
						{ title: "[[#{screen.text.inv.mng.po.qty}]]"		, field: "qty"		, hozAlign: "right" , headerHozAlign:"center"},
						{ title: "[[#{screen.text.inv.mng.po.amt}]]"		, field: "poAmt"	, hozAlign: "right" , headerHozAlign:"center"},
						{ title: "[[#{screen.text.inv.mng.charger}]]"		, field: "invReqr"	, hozAlign: "center", headerHozAlign:"center"},
						{ title: "[[#{screen.text.inv.mng.vendor.nm}]]"		, field: "vendNm"	, hozAlign: "left"	, headerHozAlign:"center"},
						{ title: "[[#{screen.text.inv.mng.order.dt}]]"		, field: "reqDt" 	, hozAlign: "center", headerHozAlign:"center"},
						{ title: "[[#{screen.text.inv.mng.ship.dt}]]"		, field: "dlvDt"	, hozAlign: "center", headerHozAlign:"center"},
						{ title: "[[#{screen.text.inv.mng.upload.valid}]]"	, field: "chkResult", hozAlign: "left"  , headerHozAlign:"center"},
						{ title: "", field: "chkFlag", visible:false}
				 	],
				});		
				
				/*---------------------- UI Events ----------------------*/
				
				$("#addFile").on("click", function(){					
					excelItems.length = 0;
					$("#upFile").click();
				});
				
				$("#upFile").on("change", function(e){
					var obj = e.target? e.target:e.srcElement;
					var addFiles = obj.files;
					excelUpData.append("file",addFiles[0]);
					$("[name='excelNm']").val(addFiles[0].name);

					//파일선택후 엑셀업로드 처리한다.
					//excelUploadProcess()
				});				
				
				//팝업창 닫기
				$("#btn_close_pop").on("click",function(){ 
					window.close();
				});				
				
				//양식다운로드
				$(".btn_download").on("click", function(){
					excelFormDownload();
				});				
				
			});
			
			//파일 다운로드
			function excelFormDownload() {				
				var fileName = "upload_invest.xlsx";
				var orgFileName = "투자정보업로드양식.xlsx";				
				var downUrl = "/file/download";
	        	var $form = $('<form></form>'); 	        	
				$form.attr('action', downUrl); 
				$form.attr('target','#downTarget'); 
				$form.attr('method','post'); 
				$form.appendTo('body'); 
				var str = $("<input name='fileName' value='"+fileName+"'/>");
				var str2 = $("<input name='orgFileName' value='"+orgFileName+"'/>");
				$form.append(str).append(str2);
				$form.submit(); 		
			}
		</script>			
			
		</script>
	
	</th:block>

	<div layout:fragment="content">
		<div id="pop_wrap" style="width:1200px;height:594px;">
				<!-- head -->
				<h3>[[#{screen.text.outofbook.screen.title2}]]
				<a href="#;" id="btn_close_pop"  class="pop_close" title="[[#{screen.text.comm.close}]]">[[#{screen.btn.close}]]</a>
				</h3>
				<!-- //head -->
				
				<!-- contents -->
				<div id="contents">
	
					<!-- 일괄업로드 -->
					<table class="form_table_NLine">
						<colgroup>
							<col style="width:15%;">
							<col style="width:25%;">
							<col style="width:15%;">
							<col>
						</colgroup>
						<tbody>
							<tr class="line">
								<th>양식다운로드</th>
								<td><a href="#;" class="btn_download">[[#{screen.text.comm.download.sample}]]</a></td>
								<th>파일업로드</th>
								<td>
									<input type="text" name="excelNm" id="excelNm" style="width:200px" readOnly >
									<input type="file" id="upFile" accept="application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" style="display:none;">
									<a href="#;" id="addFile" class="btn_srch">[[#{screen.text.comm.file.search}]]</a>																	
								</td>
							</tr>
							<tr class="line">
								<th>사유</th>
								<td colspan="3">
									<input type="text" style="width:100%;">
								</td>
							</tr>
						</tbody>
					</table>
					<!-- //일괄업로드 -->
					
					<p class="space10"></p>
					
					<!-- list 1 -->
					<div class="list_wrap">
						
						<!-- list_head -->
						<div class="list_head">
							<div class="result">Totals : 0,000</div>
							<div class="button">
								<a class="btn_list_rd">[[#{screen.btn.upload}]]</a>							
								<a class="btn_icon_list" href="#;">[[#{screen.btn.error.list}]]</a>
								<a href="#;" id="btnSave" class="btn_add">[[#{screen.text.comm.save}]]</a>
							</div>
						</div>
						<!-- //list_head -->
					
						<div id="data-table"></div>
						
					</div>
					<!-- //list 1 -->
	
				</div>
				<!-- contents -->
		</div>
		<!-- //pop_alert -->
		<div id="downTarget"></div>
	</div>			
</html>