<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorator="layout/popup2">

	<head>
	    <title>[[#{screen.text.outofbook.screen.title2}]]</title>
	</head>
        
	<!-- css -->
	<th:block layout:fragment="css">	
	    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="/css/theme.css" />
		<link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.0.8/css/tabulator.min.css" rel="stylesheet"> 
	</th:block>  

	 <th:block layout:fragment="script">
		<script type="text/javascript" src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
		<script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.0.7/dist/js/tabulator.min.js"></script>
	
		<script>

    		let grid;		
		    let excelUpData = new FormData();
		    
			$(function(){
				
				
				grid = new Tabulator("#data-table", {
				 	locale:true,
				    langs: $.commGridLocalization(),								
				 	height:"410",
				 	layout:"fitDataStretch",
				 	movableColumns:true,
				 	placeholder:"No Data Set",	
				 	index:"asetNo",				 	
				 	columns:[
				 		{formatter:"rownum", hozAlign:"center", width:40, headerSort:false},			 		
					 	{title:"[[#{screen.text.outofbook.asetNo}]]"   	, field:"asetNo"	 			, hozAlign:"center"	, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.asetType1}]]"	, field:"asetTypeNm1"	, hozAlign:"left"  		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.asetType2}]]"	, field:"asetTypeNm2"	, hozAlign:"left"  		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.asetType3}]]"	, field:"asetTypeNm3"	, hozAlign:"left"  		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.mftco}]]"	   		, field:"mftco" 				, hozAlign:"left"		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.model}]]"	   	, field:"model"				, hozAlign:"left"		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.sn}]]"	   			, field:"sn"					, hozAlign:"left"  		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.bizDept}]]"  	, field:"bizDeptNm"		, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.dept}]]"	   		, field:"deptNm"			, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.chrgr}]]"	   		, field:"chrgrNm"			, hozAlign:"center" 	, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.bsplc}]]"	   		, field:"bsplc"				, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.buld}]]"	   		, field:"buld"					, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.floor}]]"	   		, field:"floor"					, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.loc}]]"	   			, field:"loc"					, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.acqPrc}]]"	   	, field:"acqPrc"				, hozAlign:"right" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.acqDt}]]"	   	, field:"acqDt"				, hozAlign:"center" 	, headerHozAlign:"center"},
					 	
					 	{title:"[[#{screen.text.outofbook.aset.prop1}]]"	, field:"dtlInfo1"				, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop2}]]"	, field:"dtlInfo2"				, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop3}]]"	, field:"dtlInfo3"				, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop4}]]"	, field:"dtlInfo4"				, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop5}]]"	, field:"dtlInfo5"				, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop6}]]"	, field:"dtlInfo6"				, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop7}]]"	, field:"dtlInfo7"				, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop8}]]"	, field:"dtlInfo8"				, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop9}]]"	, field:"dtlInfo9"				, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop10}]]"	, field:"dtlInfo10"		, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop11}]]"	, field:"dtlInfo11"		, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop12}]]"	, field:"dtlInfo12"		, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop13}]]"	, field:"dtlInfo13"		, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop14}]]"	, field:"dtlInfo14"		, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop15}]]"	, field:"dtlInfo15"		, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop16}]]"	, field:"dtlInfo16"		, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop17}]]"	, field:"dtlInfo17"		, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop18}]]"	, field:"dtlInfo18"		, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop19}]]"	, field:"dtlInfo19"		, hozAlign:"left" 		, headerHozAlign:"center"},
					 	{title:"[[#{screen.text.outofbook.aset.prop20}]]"	, field:"dtlInfo20"		, hozAlign:"left" 		, headerHozAlign:"center"},
						{title: "[[#{screen.text.outofbook.upload.valid}]]"	, field: "chkResult"	, hozAlign:"left"  		, headerHozAlign:"center"},
				 	],
				});		
				
				/*---------------------- UI Events ----------------------*/
				
				$("#addFile").on("click", function(){					
					excelItems.length = 0;
					$("#upFile").click();
				});
				
				$("#upFile").on("change", function(e){
					var obj = e.target? e.target:e.srcElement;
					var addFiles = obj.files;
					excelUpData.append("file",addFiles[0]);
					$("[name='excelNm']").val(addFiles[0].name);

					//파일선택후 엑셀업로드 처리한다.
					//excelUploadProcess()
				});				
				
				//일괄업로드
				$("#btnUpload").on("click", function(){					

					let url = "/asset/regist/outofbook/uploadExcel";
					let reqType = "POST";	
					$.commRequestFile(url, reqType, excelUpData)
						.then((res) => {
							console.log(res);
							grid.setData(res.data);		
							$("#uploadCnt").html("Total : " + res.size);												
						})
						.catch((error) => {
							alert('[[#{screen.info.status.error.occur}]]');						
						});
					
					excelUpData.delete("file");
					$("[name='excelNm']").val("");					
					
					
				});				
				
				
				//팝업창 닫기
				$("#btn_close_pop").on("click",function(){ 
					window.close();
				});				
				
				//양식다운로드
				$(".btn_download").on("click", function(){
					excelFormDownload();
				});				
				
			});
			
			//파일 다운로드
			function excelFormDownload() {				
				var fileName = "OutOfBookAsset.xlsx";
				var orgFileName = "부외자산업로드양식.xlsx";				
				var downUrl = "/file/download";
	        	var $form = $('<form></form>'); 	        	
				$form.attr('action', downUrl); 
				$form.attr('target','#downTarget'); 
				$form.attr('method','post'); 
				$form.appendTo('body'); 
				var str = $("<input name='fileName' value='"+fileName+"'/>");
				var str2 = $("<input name='orgFileName' value='"+orgFileName+"'/>");
				$form.append(str).append(str2);
				$form.submit(); 		
			}
		</script>			

	</th:block>

	<div layout:fragment="content">
		<div id="pop_wrap" style="width:1200px;height:594px;">
				<!-- head -->
				<h3>[[#{screen.text.outofbook.screen.title2}]]
				<a href="#;" id="btn_close_pop"  class="pop_close" title="[[#{screen.text.comm.close}]]">[[#{screen.btn.close}]]</a>
				</h3>
				<!-- //head -->
				
				<!-- contents -->
				<div id="contents">
	
					<!-- 일괄업로드 -->
					<table class="form_table_NLine">
						<colgroup>
							<col style="width:15%;">
							<col style="width:25%;">
							<col style="width:15%;">
							<col>
						</colgroup>
						<tbody>
							<tr class="line">
								<th>양식다운로드</th>
								<td><a href="#;" class="btn_download">[[#{screen.text.comm.download.sample}]]</a></td>
								<th>파일업로드</th>
								<td>
									<input type="text" name="excelNm" id="excelNm" style="width:200px" readOnly >
									<input type="file" id="upFile" accept="application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" style="display:none;">
									<a href="#;" id="addFile" class="btn_srch">[[#{screen.text.comm.file.search}]]</a>																	
								</td>
							</tr>
							<tr class="line">
								<th>사유</th>
								<td colspan="3">
									<input type="text" style="width:100%;">
								</td>
							</tr>
						</tbody>
					</table>
					<!-- //일괄업로드 -->
					
					<p class="space10"></p>
					
					<!-- list 1 -->
					<div class="list_wrap">
						
						<!-- list_head -->
						<div class="list_head">
							<div id="uploadCnt" class="result">Totals : 0,000</div>
							<div class="button">
								<a id="btnUpload" class="btn_list_rd">[[#{screen.btn.upload}]]</a>							
								<a id="btnError" class="btn_icon_list" href="#;">[[#{screen.btn.error.list}]]</a>
								<a href="#;" id="btnSave" class="btn_add">[[#{screen.text.comm.save}]]</a>
							</div>
						</div>
						<!-- //list_head -->
					
						<div id="data-table"></div>
						
					</div>
					<!-- //list 1 -->
	
				</div>
				<!-- contents -->
		</div>
		<!-- //pop_alert -->
		<div id="downTarget"></div>
	</div>			
</html>