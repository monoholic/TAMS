<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
        layout:decorator="layout/default">
        
	<head>
	    <title>[[#{screen.text.asset.status.screen.title}]]</title>
	</head>        
        
	<!-- css -->
	<th:block layout:fragment="css">
	    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="/css/jsgrid.css" />
		<link rel="stylesheet" href="/css/theme.css" />		
	</th:block>        
        
	<th:block layout:fragment="script">
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
		<script src="/js/jsgrid/db.js"></script>
	    <script src="/js/jsgrid/jsgrid.core.js"></script>
	    <script src="/js/jsgrid/jsgrid.load-indicator.js"></script>
	    <script src="/js/jsgrid/jsgrid.load-strategies.js"></script>
	    <script src="/js/jsgrid/jsgrid.sort-strategies.js"></script>
	    <script src="/js/jsgrid/jsgrid.field.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.text.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.number.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.select.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.checkbox.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.control.js"></script>	        
	
		<script>
	    	let numOfRows = 10;
	    	let status = true;		
		
			$(function(){
				
		        $("#jsGrid").jsGrid({
		        	height: "100%",
	                width: "100%",
	                filtering: false,
	                editing: true,
	                inserting: true,
	                sorting: true,
	                paging: true,
	                sorter: "number",
	                pageIndex:1,
	                pageFirstText:'<a class="first"><img src="/images/common/btn_pn_first.gif"></img></a>',
	                pagePrevText: '<a class="pre"><img src="/images/common/btn_pn_pre.gif"></img></a>',
	                pageNextText: '<a class="next"><img src="/images/common/btn_pn_next.gif"></img></a>',
	                pageLastText: '<a class="last"><img src="/images/common/btn_pn_last.gif"></img></a>',
	                pagerFormat: "{first} {prev} {pages} {next} {last}",
	                pagerContainer:null,
	                pageLoading: true,
	                pager: "#pager",
	                autoload: status,
	                pageSize: numOfRows,
	                pageButtonCount: 5,
	                loadonce: true,
	                updateOnResize: true, 
		            rowClick: function(args){}, 
		            pagerContainerClass: "paginate",
		            deleteConfirm: function(item) {
		                console.log(item);		                
		            },
		            controller: {
		                loadData: function(filter){
		                	let d = $.Deferred();
			                currentPage = filter.pageIndex;

		                    let url = "/asset/status/information/assetStatusList";
							let reqType = 'GET';	
							let params = getParams();							
							params.sortField = filter.sortField;
							params.sortOrder = filter.sortOrder;
							
							$.commRequest(url, reqType, params)
							.then((res) => {
								$(".result").text("Results : " + res.condition.totalCount);
								d.resolve({data : res.data, itemsCount: res.condition.totalCount});

							})
							.catch((error) => {
								console.log('조회 실패!!');
							});
							
							return d.promise();							
		                }
	            	},
		            fields: [
		            	{ name: "asetNo"    	, type: "text", width: 70 , align: "left", title: "[[#{screen.text.asset.asetNo}]]"},
		                { name: "asetType1Nm" 	, type: "text", width: 100, align: "left", title: "[[#{screen.text.asset.asetType1}]]"},
		                { name: "asetType2Nm" 	, type: "text", width: 100, align: "left", title: "[[#{screen.text.asset.asetType2}]]"},
		                { name: "asetType3Nm"	, type: "text", width: 100, align: "left", title: "[[#{screen.text.asset.asetType3}]]"},
		                { name: "mftco"   		, type: "text", width: 100, align: "left", title: "[[#{screen.text.asset.mftco}]]"},
		                { name: "model"	   		, type: "text", width: 100, align: "left", title: "[[#{screen.text.asset.model}]]"},
		                { name: "sn"    		, type: "text", width: 80 , align: "left", title: "[[#{screen.text.asset.sn}]]"},
		                { name: "bizDeptNm"		, type: "text", width: 100, align: "left", title: "[[#{screen.text.asset.bizDeptCd}]]"},
		                { name: "deptNm"   		, type: "text", width: 100, align: "left", title: "[[#{screen.text.asset.deptCd}]]"},
		                { name: "chrgr"  		, type: "text", width: 100, align: "center", title: "[[#{screen.text.asset.chrgr}]]"},
		                { name: "asetStusNm"	, type: "text", width: 100, align: "center", title: "[[#{screen.text.asset.asetStus}]]"  }
		            ]
		        });				
		        
		        //자산유형1 코드 조회
		        getCommCode("#asetType1", "AS_CLASS", "1", "");
		        
		        //자산상태
		        getCommCode("#asetStatus", "AS_STATUS", "1", "");
		        
		      	//자산유형1 change 이벤트
		        $("#asetType1").change(function(){
		        	let type1 = $("#asetType1").val();

	        		$('#asetType2').children('option:not(:first)').remove();
	        		$('#asetType3').children('option:not(:first)').remove();
	        		
		        	if(type1 != 'ALL') {
		        		getCommCode("#asetType2", "AS_CLASS", "2", type1);
		        	}
		        });
		        
		        //자산유형2 change 이벤트
		        $("#asetType2").change(function(){
		        	let type2 = $("#asetType2").val();
		        	
		        	$('#asetType3').children('option:not(:first)').remove();
		        	
		        	if(type2 != 'ALL') {		        		
		        		getCommCode("#asetType3", "AS_CLASS", "3", type2);
		        	}
		        });		        
		        
    	        let DEPT_URL = "/common/popup/deptTreePopup";
    	        let DEPT_ID = "DeptPopup";
    	        let DEPT_ARGS = {
	        		width:500,
	        	    height:450,
	        	    fullscreen:"no",
	        	    resizable:"no"	        	        		
    	        };	      
		        
    	        //사업부 조회
	     	    $("#bizDeptPopup").on("click", function() {
			     	var params = {
	        	        searchType:"BIZ_DEPT",
	     	        	deptCd:"#bizDeptCd",
	     	        	deptNm:"#bizDeptNm" 	  	        	        	         	    		
	         	    }; 	        		        	        
	        	    openPopup2(DEPT_ID, DEPT_URL, DEPT_ARGS, params);
	         	 });	
	     	    
    	        //부서 조회
	     	    $("#deptPopup").on("click", function() {
			     	var params = {
	        	        searchType:"DEPT",
	     	        	deptCd:"#deptCd",
	     	        	deptNm:"#deptNm" 	  	        	        	         	    		
	         	    }; 	        		        	        
	        	    openPopup2(DEPT_ID, DEPT_URL, DEPT_ARGS, params);
	         	 });		     	    
		        
	          	//리셋 버튼
	    	    $(".btn_reset").click(function() {
	    	    	$("#asetNo").val("");
	    	    	
	    	    	$('#asetType1').val("ALL").attr("selected", "selected");
	    	    	$('#asetType2').children('option:not(:first)').remove();
	    	    	$('#asetType3 ').children('option:not(:first)').remove();
	    	    		    	    	
	    	    	$("#bizDeptCd").val("");
	    	    	$("#bizDeptNm").val("");
	    	    	$("#deptCd").val("");
	    	    	$("#deptNm").val("");
	    	    	
	    	    	$("#chrgr").val("");
	    	    	$("#mftco").val("");
	    	    	$("#model").val("");
	    	    		    	    	
	    	    	$('#asetStatus').val("ALL").attr("selected", "selected");
	    	    });    	        
    	        
	          	//조회 버튼
	    	    $(".btn_srch").on("click",function (){
	    	    	$("#jsGrid").jsGrid().trigger("loadData");
		        });	          	
	          	
				//엔터키
	    	    $(document).keypress(function(event){	    	    	
	    	        var keycode = (event.keyCode ? event.keyCode : event.which);
	    	        console.log(event);
	    	        if(keycode == '13'){
	    	        	$("#jsGrid").jsGrid().trigger("loadData");
	    	        }
	    	    }); 	
				
				//엑셀 다운로드
				$(".btn_list_rd").on("click", function(){
					let url = "/asset/status/information/excelDownload";
					$.commExcelDown(url, getParams());
					
				});
			});
			
			function getCommCode(id, code, level, upperCodeId){				
				let url = "/common/comm/selectBox";
				let reqType = 'GET';
				$.commRequestSelectbox(url, reqType, id, code, level, upperCodeId);			
			}

			function getParams(){
				return {
        				"currentPage": $("#jsGrid").jsGrid("option", "pageIndex"),
        				"numOfRows"  : numOfRows,
        				"asetNo"   	 : $("#asetNo").val(),
    				    "asetType1"	 : $("#asetType1").val(),
    				    "asetType2"	 : $("#asetType2").val(),
    				    "asetType3"	 : $("#asetType3").val(),
    				    "bizDeptCd"	 : $("#bizDeptCd").val(),
    				    "deptCd"	 : $("#deptCd").val(),
    				    "chrgr"		 : $("#chrgr").val(),        				    
        			    "mftco"      : $("#mftco").val(),
    				    "model"      : $("#model").val(),
    				    "asetStatus" : $("#asetStatus").val(),        				    
        			}
			}						
		</script>	
	</th:block>
	
	<div layout:fragment="content">
		<!-- contents_head -->
		<div class="bc">Home &gt; <span th:text="${menuDesc}"></span></div>
		<h3><span th:text="${menuNm}"></span></h3>

		<!-- //contents_head -->	
	
		<!-- contents -->
		<div id="contents">
			<div class="srch_wrap">
				<!-- search_form -->
				<div class="srch_form">
					<table class="srch_table">
						<colgroup>
							<col width="10%"/>
							<col width="23%"/>
							<col width="10%"/>
							<col width="23%"/>
							<col width="10%"/>
							<col width="23%"/>
						</colgroup>		
						<tr>
							<th>[[#{screen.text.asset.asetNo}]]</th>
							<td><input id="asetNo" type="text" style="width:100%;"></td>
							<th>[[#{screen.text.asset.asetType}]]</th>
							<td colspan="3">
								<select id="asetType1" style="width:33%;">
									<option>ALL</option>
								</select>							
								<select id="asetType2" style="width:33%;">
									<option>ALL</option>
								</select>
								<select id="asetType3" style="width:33%;">
									<option>ALL</option>
								</select>							
							</td>
						</tr>
						<tr>
							<th>[[#{screen.text.asset.bizDeptCd}]]</th>
							<td>
								<input type="hidden" id="bizDeptCd"/>
								<input type="text" id="bizDeptNm" style="width:91%;" readonly/>							
								<a href="#" id="bizDeptPopup" >
									<img title="" class="ico_search" alt="Search" src="/images/common/ico_search.png">
								</a>
							</td>
							<th>[[#{screen.text.asset.deptCd}]]</th>
							<td>
								<input type="hidden" id="deptCd"/>
								<input type="text" id="deptNm" style="width:91%;" readonly/>							
								<a href="#" id="deptPopup" >
									<img title="" class="ico_search" alt="Search" src="/images/common/ico_search.png">
								</a>
							</td>
							<th>[[#{screen.text.asset.chrgr}]]</th>
							<td><input id="chrgr" type="text" style="width:100%;"></td>
						</tr>
						<tr>
							<th>[[#{screen.text.asset.mftco}]]</th>
							<td><input id="mftco" type="text" style="width:100%;"></td>
							<th>[[#{screen.text.asset.model}]]</th>
							<td><input id="model" type="text" style="width:100%;"></td>
							<th>[[#{screen.text.asset.asetStus}]]</th>
							<td>
								<select id="asetStatus" style="width:100%;">
									<option>ALL</option>
								</select>
							</td>
						</tr>						
					</table>
					<!-- search_button -->
					<div class="button">
						<a href="#;" class="btn_reset">[[#{screen.btn.reset}]]</a>
						<a href="#;" class="btn_srch">[[#{screen.btn.search}]]</a>
					</div>
					<!-- //search_button -->					
				</div>
				<!-- //search_form -->				
			</div>	
			<!-- list -->
			<div class="list_wrap">
				<!-- list_head -->
				<div class="list_head">
					<div class="result">Results : 0,000</div>
					<!-- list_button -->
					<div class="button">
						<a class="btn_list_rd">[[#{screen.btn.excel}]]</a>
					</div>
					<!-- list_button -->
				</div>
				<!-- //list_head -->	
				
				<div style="height:580px;overflow:auto !important;">
					<div id="jsGrid"></div>
				</div>							
			</div>		
			<!-- //list -->					
					
		</div>		
	</div>	        
</html>        