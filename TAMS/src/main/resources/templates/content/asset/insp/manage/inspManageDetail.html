<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorator="layout/default">

	<head>
	    <title>[[#{screen.text.modify.screen.title2}]]</title>
	</head>
        
	<!-- css -->
	<th:block layout:fragment="css">
	    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="/css/jsgrid.css" />
		<link rel="stylesheet" href="/css/theme.css" />
	</th:block>
	
	<th:block layout:fragment="script">
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
		<script src="/js/jsgrid/db.js"></script>
	    <script src="/js/jsgrid/jsgrid.core.js"></script>
	    <script src="/js/jsgrid/jsgrid.load-indicator.js"></script>
	    <script src="/js/jsgrid/jsgrid.load-strategies.js"></script>
	    <script src="/js/jsgrid/jsgrid.sort-strategies.js"></script>
	    <script src="/js/jsgrid/jsgrid.field.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.text.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.number.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.select.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.checkbox.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.control.js"></script>	
		
	    <script>
	    
	    $(function(){
	    	const SCREEN_NM = "INSP_MANAGE_LIST";   
	    	loadParams = $.commLoadSearchParams(SCREEN_NM);
	    	
	    	$("#jsGrid").jsGrid("loadData");
	    	
	        $("#pager").on("change", function() {
	            var page = parseInt($(this).val(), 10);
	            $("#jsGrid").find(".jsgrid-table").append("<tr class='jsgrid-row'></tr>");
	        });
	        
	        var selectItem = function(item) {
		    	if(!selectedItems.includes(item)) selectedItems.push(item);
		    	
			    if($(".singleCheckbox").length == $(".singleCheckbox:checked").length) {
	                $("#selectAllCheckbox").prop("checked", true);
		        } else {
		            $("#selectAllCheckbox").prop("checked", false);
		        }
			};
		     
		    var unselectItem = function(item) {
			    selectedItems = $.grep(selectedItems, function(i) {
			    	return i !== item;
			    });
			    if(selectedItems.length == 0) {
			    	$('#selectAllCheckbox').attr('checked', false);
			    }
			    if($(".singleCheckbox").length == $(".singleCheckbox:checked").length) {
	             	$("#selectAllCheckbox").prop("checked", true);
	         	} else {
	            	$("#selectAllCheckbox").prop("checked", false);
	          	}
		    };
	        
	        $("#jsGrid").jsGrid({
	        	height: "550",
                width: "100%",
                filtering: false,
                editing: true,
                inserting: false,
                sorting: true,
                paging: true,
                sorter: "number",
                pageIndex:1,
                pageFirstText:'<a class="first"><img src="/images/common/btn_pn_first.gif"></img></a>',
                pagePrevText: '<a class="pre"><img src="/images/common/btn_pn_pre.gif"></img></a>',
                pageNextText: '<a class="next"><img src="/images/common/btn_pn_next.gif"></img></a>',
                pageLastText: '<a class="last"><img src="/images/common/btn_pn_last.gif"></img></a>',
                pagerFormat: "{first} {prev} {pages} {next} {last}",
                pagerContainer:null,
                pageLoading: true,
                pager: "#pager",
                pageSize: numOfRows,
                pageButtonCount: 5,
                loadonce: true,
                updateOnResize: true, 
	            rowClick: function(args) {
	            	var $target = $(args.event.target); // 클릭한 셀 jquery object 
	            	var columnIdx = $target.index(); // 클릭한 셀이 몇번째 컬럼인지 저장 
	            	var inspNo =  args.item.inspNo// 해당 로우의 실사번호 
	            	
					if(columnIdx == 0) { // 체크박스 클릭 
					   	$("<input>").attr("type", "checkbox").attr("class","singleCheckbox")
					                .prop("checked", $.inArray(args.item.firstName, selectedItems) > -1)
					                .on("change", function () {
						  	 $(this).is(":checked") ? selectItem(item) : unselectItem(item);
						});
					} else { // 디테일 화면으로 이동  
						openInspDetail(inspNo);
					}
	            },
	            pagerContainerClass: "paginate",
	            deleteConfirm: function(item) {
	                return "\""+item.menuNm+"("+menuId+")"+"\""+ '[[#{screen.info.status.delete.yn}]]';
	            },
	            controller:  {
	                loadData: function(filter) {
	                    var d = $.Deferred();
	                    
	                    currentPage = filter.pageIndex; 
	                    let url = "/asset/insp/manage/selectInspAsetList";
						let reqType = 'GET';	
						let data = {
            				"currentPage"  : filter.pageIndex,
            				"numOfRows"    : numOfRows,
            				"inspYear" 	   : $("#inspNo").val(),
            				"searchOption" : $("#searchOption option:selected").val(),
            				"sortField"    : filter.sortField,
            				"sortOrder"    : filter.sortOrder
            			}
						
						$.commRequest(url, reqType, data)
							.then((res) => {
								condition = res.condition;
								codeGrpMngList = res.data;
								$(".result").text("Results : " + res.condition.totalCount);
								d.resolve({data : res.data, itemsCount: res.condition.totalCount});
							})
							.catch((error) => {
								console.log('[[#{screen.info.status.error.search}]]');
							});						
	                    
	                    return d.promise();
	                },

           		},
	            fields: [
	            	{  	   name : "chk"
	                	 , align: "center"
	                	 , width: 5
	                	 , title: ""
	                	 , editing: false
	                	 , sorting: false
	                	 , filtering: false
	                	 , itemTemplate: function(value, item) {
	                       return $("<input>").attr("type", "checkbox").attr("class","singleCheckbox")
	                       .prop("checked", $.inArray(item.firstName, selectedItems) > -1)
	                       .on("change", function () {
	  					  	 //$(this).is(":checked") ? selectItem($(this).parent().next().text()) : unselectItem($(this).parent().next().text());
	  					  	 $(this).is(":checked") ? selectItem(item.inspNo) : unselectItem(item.inspNo);
	  					  	 });
	            		   }
	                	 , headerTemplate : function ()  { 
						  	 return  $("<input>").attr("type", "checkbox").attr("id","selectAllCheckbox")
		                     .on("change", function (item) {
		             	    	selectedItems = [];
		            	    	if(this.checked) { 
		            	            $('.singleCheckbox').each(function() { 
		            	                this.checked = true;   
		            	                selectItem($(this).parent().next().text());           
		            	            });			         
		            	        }else {
		            	        	
		            	            $('.singleCheckbox').each(function() { 
		            	                this.checked = false;      
		            	                unselectItem(item);
		            	            });  
		            	            selectedItems = [];
		            	        }
		    				   });
					 	 } ,
	                },
	                { name:"inspNo"			, type:"text", align:"center", width:10, title:"[[#{screen.text.asset.inspNo}]]"},			//실사번호

	            ]
	        });          	
	        
	        
	        
	        
    	});   // $(function()
    		
    	// 삭제 시 이전 페이지로 이동
    	function requestListView() {
    		let url = "/asset/insp/manage/list";
    		
    		var $form = $('<form></form>'); 
				$form.attr('action', url); 
				$form.attr('method', 'post'); 
				$form.attr('target', '_self'); 
				inputStr = $('<input type="hidden" value="'+ loadParams.menuId + '" name="menuId">');
				$form.append(inputStr);
				inputStr = $('<input type="hidden" value="'+ loadParams.menuNm + '" name="menuNm">');	
				$form.append(inputStr);
				inputStr = $('<input type="hidden" value="'+ loadParams.menuDesc + '" name="menuDesc">');	
				$form.append(inputStr);
				inputStr = $('<input type="hidden" value="Y" name="loadParams">');
				$form.append(inputStr);
				$form.appendTo('body'); 
				$form.submit();
	    }
	    
	    </script>
	</th:block>

	<div layout:fragment="content">
		<h3><span>[[#{screen.text.modify.screen.title3}]]</span></h3>
		<div class="list_head">
			<div class="list_head">
				<div><h6>[[#{screen.text.asset.asetInspInfo}]]</h6></div>
			</div>
			<div class="button">
				<a class="btn_save1">[[#{screen.text.comm.save}]]</a>
				<a class="btn_del1">[[#{screen.btn.delete}]]</a>
				<a class="btn_" id="requestBack" onclick="requestListView()">뒤로가기</a>
			</div>
		</div>
		
		<div class="srch_wrap single">
			<table class="srch_table">
				<colgroup>
					<col width="10%"/>
					<col width="20%"/>
					<col width="15%"/>
					<col width="20%"/>
					<col width="15%"/>
					<col width=""/>
				</colgroup>
				<tr>
					<th>[[#{screen.text.asset.inspNo}]]</th><!-- 실사번호 -->
					<td><input type="text" id="inspNo" style="width:100%;" th:value="${inspNo}" disabled="disabled"></td>
					<th>[[#{screen.text.asset.inspNm}]]</th><!-- 실사명 -->
					<td colspan="3"><input type="text" id="inspNm" style="width:100%;" th:value="${inspNm}" ></td>
				</tr>
				<tr>
					<th>[[#{screen.text.asset.inspStDt}]]</th><!-- 실사시작일 -->
					<td>
						<div style='display:flex'><input type="date" id="inspStDt" style="width:100%"></div>
					</td>
					<th>[[#{screen.text.asset.inspEndDt}]]</th><!-- 실사종료일 -->
					<td>
						<div style='display:flex'><input type="date" id="inspEndDt" style="width:100%"></div>
					</td>
					<th>[[#{screen.text.asset.onlineInspBaseDt}]]</th><!-- 온라인실사기준일 -->
					<td>
						<div style='display:flex'><input type="date" id="onlineInspBaseDt" style="width:100%"></div>
					</td>
				</tr>
				<tr>
					<th>[[#{screen.text.asset.inspRegr}]]</th><!-- 생성자 -->
					<td><input type="text" id="regr" disabled="disabled" style="width:100%;" th:value="${regr}"> </td>
					<th>[[#{screen.text.asset.inspRegDt}]]</th><!-- 생성일자 -->
					<td><input type="text" id="regDt" disabled="disabled" style="width:100%;" th:value="${regDt}"></td>
					<th>[[#{screen.text.asset.inspStus}]]</th><!-- 실사상태 -->
					<td><input type="text" id="inspStus" disabled="disabled" style="width:100%;" th:value="${inspStus}"></td>
				</tr>
			</table>
		</div><br>
		
		<div class="list_head" style="display: flex;">
			<div><h6>[[#{screen.text.modify.screen.title5}]]</h6></div>
			<div class="result" style="margin-left: 20px;">Results : 0,000</div>
			<div class="button">
				<a class="btn_add">[[#{screen.text.comm.add.asset}]]</a>
				<a class="btn_save2" id="save">[[#{screen.text.comm.save}]]</a>
				<a class="btn_del2">[[#{screen.btn.delete}]]</a>
			</div>
		</div>
		<div id="jsGrid"></div>
		<input type="hidden" id="curr_Idx"/>
		<div id="excelDownTarget"></div>
	</div>
</html>