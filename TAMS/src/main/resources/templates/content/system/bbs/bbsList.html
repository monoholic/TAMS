<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorator="layout/default">

	<head>
	    <title>게시판 관리</title>
	</head>
        
	<!-- css -->
	<th:block layout:fragment="css">
	    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="/css/jsgrid.css" />
		<link rel="stylesheet" href="/css/theme.css" />
		
	</th:block>
	
	<th:block layout:fragment="script">
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
		<script src="/js/jsgrid/db.js"></script>
	    <script src="/js/jsgrid/jsgrid.core.js"></script>
	    <script src="/js/jsgrid/jsgrid.load-indicator.js"></script>
	    <script src="/js/jsgrid/jsgrid.load-strategies.js"></script>
	    <script src="/js/jsgrid/jsgrid.sort-strategies.js"></script>
	    <script src="/js/jsgrid/jsgrid.field.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.text.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.number.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.select.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.checkbox.js"></script>
	    <script src="/js/jsgrid/fields/jsgrid.field.control.js"></script>	
		
	    <script>
	    let numOfRows = 10;
	    var status = true;
        var selectedItems = [];
	 	var insertedItems = [];
	 	var updatedItems = [];
	    
	 	$(document).ready(function(){                                                                    
		 	let url = '/system/bbs/bbsMng/codeList';                                                      
		 	let reqType = 'POST';                                                                        
		 	let data = {
		 		"email" : ""                                                                             
		 	};                                                                                           
		 	$.commRequest(url, reqType, JSON.stringify(data))                                            
		 		.then((res) => {                                                                         
		 			$.each(res.data, function(i){                                                        
		 				var codeGrpList = res.data[i];                                                  
		 				$("#bbsGrpId").append('<option value="">' + codeGrpList.codeNm+ '</option>');
		 			})
		 		})
		 		.catch((error) => {                                                                      
		 			alert('메뉴조회 실패!!');                                                                  
		 		});
		 });
	 	
	    $(function(){
	    	
	        $("#jsGrid").jsGrid({
	        	height: "400",
                width: "100%",
                filtering: false,
                editing: true,
                inserting: true,
                sorting: true,
                paging: true,
                sorter: "number",
                pageIndex:1,
                pageFirstText:'<a class="first"><img src="/images/common/btn_pn_first.gif"></img></a>',
                pagePrevText: '<a class="pre"><img src="/images/common/btn_pn_pre.gif"></img></a>',
                pageNextText: '<a class="next"><img src="/images/common/btn_pn_next.gif"></img></a>',
                pageLastText: '<a class="last"><img src="/images/common/btn_pn_last.gif"></img></a>',
                pagerFormat: "{first} {prev} {pages} {next} {last}",
                pagerContainer:null,
                pageLoading: true,
                pager: "#pager",
                autoload: status,
                pageSize: numOfRows,
                pageButtonCount: 5,
                loadonce: true,
                updateOnResize: true, 
	            rowClick: function(args) {
	            	var target = args.event.target;
	            	
					if(target instanceof HTMLTableCellElement) {
						// detail bbs
						showDetailBbs(args.item);
					} else {
					   	$("<input>").attr("type", "checkbox").attr("class","singleCheckbox")
					                .prop("checked", $.inArray(args.item.firstName, selectedItems) > -1)
					                .on("change", function () {
						  	 $(this).is(":checked") ? selectItem(item) : unselectItem(item);
						});
					}
	            }, 
	            pagerContainerClass: "paginate",
	            deleteConfirm: function(item) {
	                return "\""+item.menuNm+"("+menuId+")"+"\""+ "을 삭제 하시겠습니까?";
	            },
	            controller:  {
	                loadData: function(filter) {
	                    var d = $.Deferred();
	                    
	                    currentPage = filter.pageIndex; 
               			
	                    let url = "/system/bbs/bbsMng/bbsList";
						let reqType = 'GET';	
						let data = {
            				"currentPage"  : filter.pageIndex,
            				"numOfRows"    : numOfRows,
            				"searchText"   : $("#searchText").val(),
            				"searchOption" : $("#searchOption option:selected").val(),
            				"useYnOption"  : $("#delYnOption option:selected").val(),
            				"sortField"    : filter.sortField,
            				"sortOrder"    : filter.sortOrder
            			}
						$.commRequest(url, reqType, data)
							.then((res) => {
								$(".result").text("Results : " + res.condition.totalCount);
								d.resolve({data : res.data, itemsCount: res.condition.totalCount});

							})
							.catch((error) => {
								console.log('메뉴조회 실패!!');
							});						
	                    
	                    return d.promise();
	                },
            	},
            	
	            fields: [
	                { name: "bbsId", type: "number", align: "center", width: 15,  title: "번호" },
	                { name: "bbsTtl", type: "text", align: "left", width: 150, title: "게시글 제목" },
	                { name: "userId", type: "text", align: "left", width: 20, readOnly:true , title: "작성자" },
	                { name: "regDt", type: "text", align: "center", width: 30, title: "작성일" },
	                { name: "viewCnt", type: "number", align: "center", width: 15, title: "조회수" },
	            ]
	        });
	        
	        $("#pager").on("change", function() {
	            var page = parseInt($(this).val(), 10);
	            $("#jsGrid").find(".jsgrid-table").append("<tr class='jsgrid-row'></tr>");
	        });

    	    $(".btn_srch").on("click",function (){
	    	   $("#jsGrid").jsGrid().trigger("loadData");
	        });
	        
          	//리셋 버튼
    	    $(".btn_reset").click(function() {
    	    	$("#searchText").val("");
    	    	$("#searchOption option:eq(0)").prop("selected",true);
    	    	$("#delYnOption option:eq(0)").prop("selected",true);
    	    });
    	});
	    
	    function showDetailBbs(item) {
	    	var $form = $('<form id="form"></form>'); 
			$form.attr('action', "/system/bbs/detailBbs"); 
			$form.attr('method', 'post'); 
			$form.appendTo('body');
			
			var bbsIdStr = $('<input type="hidden" value="'+item.bbsId+'" name="bbsId">');
			
			$form.append(bbsIdStr);
			
			$form.submit();
	    }
	    
	    function enterkey() {
	    	if (window.event.keyCode == 13) {
	    		$("#jsGrid").jsGrid().trigger("loadData");
	        }
	    }
	    </script>	
	</th:block>

	<div layout:fragment="content">
		<!-- contents_head -->
		<div class="bc">Home &gt; <span th:text="${menuDesc}"></span></div>
		<h3><span th:text="${menuNm}"></span></h3>
		<!-- //contents_head -->

		<!-- search -->
		<div class="srch_wrap single">
			<table class="srch_table">
			<colgroup>
					<col width="10%"/>
					<col width="20%"/>
					<col width="15%"/>
					<col width="20%"/>
					<col width="15%"/>
					<col width="15%"/>
			</colgroup>
				<tr>
					<td>
						<select id="searchOption" style="width:90%;">
							<option value="">검색항목 선택</option>
							<option value="bbs_ttl">게시글 제목</option>
						</select>
					</td>	
					<td>
						<input id="searchText" type="text" onkeyup="enterkey()" style="width:90%; margin:10px;">
					</td>
					
					<td>
						<select id="delYnOption" style="width:40%;">
							<option value="">삭제 구분</option>
							<option value="Y">삭제</option>
							<option value="N">미삭제</option>
						</select>
					</td>
					
					<td class="search" colspan="3">
						<a href="#;" class="btn_reset">Reset</a>
						<a href="#;" class="btn_srch">Search</a>
					</td>
				</tr>
			</table>
		</div>
		<!-- //search -->
		<div class="list_head">
			<div class="result">Results : 0,000</div>
		</div>
		<!-- //search -->

		<!-- list -->
		<div id="jsGrid"></div>
		<!-- list -->
	</div>
</html>