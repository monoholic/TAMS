<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.trito.tams.web.common.mapper.CommonMapper">

	<!-- 부서팝업 조회 -->
	<select id="selectDeptPopupList" resultType="kr.co.trito.tams.web.common.dto.DeptDto" parameterType="kr.co.trito.tams.comm.util.search.SearchCondition">
		WITH RECURSIVE CTE AS ( 
		    SELECT
				DEPT_CD ,
				DEPT_NM ,
				UPP_DEPT_CD ,
				DEPT_CHRGR_ID,
				1 AS LEVEL
			FROM
				TB_DEPT
			WHERE
				UPP_DEPT_CD IS NULL
				AND USE_YN = 'Y'
			UNION ALL
			SELECT
				B.DEPT_CD ,
				B.DEPT_NM ,
				B.UPP_DEPT_CD ,
				B.DEPT_CHRGR_ID,
				C.LEVEL + 1 AS LEVEL
		    FROM TB_DEPT B 
		    INNER JOIN CTE C ON B.UPP_DEPT_CD = C.DEPT_CD 
		    ) 
		SELECT DEPT_CD        AS deptCd
		     , DEPT_NM        AS deptNm 
		     , DEPT_CHRGR_ID  AS deptChrgrId
		     , UPP_DEPT_CD    AS uppDeptCd
		  FROM CTE 
	   	WHERE 1=1
	   	<if test="params.searchText!=null">
	   	  AND (DEPT_CD LIKE CONCAT('%', #{params.searchText}, '%') OR DEPT_NM LIKE CONCAT('%', #{params.searchText}, '%') )
	   	</if>
		ORDER BY DEPT_CD
	</select>
	
</mapper>