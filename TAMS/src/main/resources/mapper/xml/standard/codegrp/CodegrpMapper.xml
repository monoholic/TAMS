<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.trito.tams.web.standard.codegrp.mapper.CodegrpMapper">
   	
   	<!-- 공통코드 그룹 관리 리스트 출력 -->
   	<select id="selectCodegrpList" resultType="kr.co.trito.tams.web.standard.codegrp.dto.CodegrpDto" parameterType="kr.co.trito.tams.comm.util.search.SearchCondition"> 
   		SELECT a.code_grp_id
   			 , a.code_grp_nm
   			 , a.code_grp_eng_nm
   			 , a.code_grp_desc
   			 , a.sort_odr
   			 , a.use_yn
   			 , a.updr
   			 , DATE_FORMAT(a.up_dt, '%Y-%m-%d') AS up_dt
   			 , a.regr
   			 , DATE_FORMAT(a.reg_dt, '%Y-%m-%d') AS reg_dt
		FROM (
			   		SELECT code_grp_id
			   			 , code_grp_nm
			   			 , code_grp_eng_nm
			   			 , code_grp_desc
			   			 , sort_odr
			   			 , use_yn
			   			 , updr
			   			 , up_dt
			   			 , regr
			   			 , reg_dt
			   			 , ROW_NUMBER() OVER(ORDER BY CAST(sort_odr AS int)) AS rn
					FROM tb_com_code_grp
					WHERE 1=1 
						<if test="params.searchText != ''">
							AND ( code_grp_id LIKE CONCAT('%', #{params.searchText}, '%')		
						       OR code_grp_nm LIKE CONCAT('%', #{params.searchText}, '%')
						       OR code_grp_desc LIKE CONCAT('%', #{params.searchText}, '%'))
					 	</if>
					 	<choose>
						 		<when test="params.searchOption == 'code_grp_id'">
						 			<if test="params.searchText != null">
										AND code_grp_id LIKE CONCAT('%', #{params.searchText}, '%')
									</if>
						 		</when>
						 		
						 		<when test="params.searchOption == 'code_grp_nm'" >
						 			<if test="params.searchText != null">
						 				AND code_grp_nm LIKE CONCAT('%', #{params.searchText}, '%')
						 			</if>
						 		</when>
						 		
						 		<when test="params.searchOption == 'code_grp_desc'" >
						 			<if test="params.searchText != null">
						 				AND code_grp_desc LIKE CONCAT('%', #{params.searchText}, '%')
						 			</if>
						 		</when>
					 	</choose>
					 	
						<if test="params.useYnOption !=''">
							AND use_yn = #{params.useYnOption}
				 		</if>
		) As a
		WHERE rn BETWEEN #{start} AND #{end}
		ORDER BY a.sort_odr, a.code_grp_id
   	</select>
   	
   	<!-- 공통코드그룹관리 카운트 -->
   	<select id="selectCountCodegrp" resultType="int" parameterType="kr.co.trito.tams.comm.util.search.SearchCondition">
		SELECT count(*) cnt 
		  FROM tb_com_code_grp 
		 WHERE 1=1
			<if test="params.searchText != ''">
				AND ( code_grp_id LIKE CONCAT('%', #{params.searchText}, '%')		
			       OR code_grp_nm LIKE CONCAT('%', #{params.searchText}, '%')
			       OR code_grp_desc LIKE CONCAT('%', #{params.searchText}, '%'))
		 	</if>
		 	
		 	<choose>
		 		<when test="params.searchOption eq 'code_grp_id'">
		 			<if test="params.searchText != null">
		 				AND code_grp_id LIKE CONCAT('%', #{params.searchText}, '%')
		 			</if>
		 		</when>
		 		
		 		<when test="params.searchOption eq 'code_grp_nm'" >
		 			<if test="params.searchText != null">
		 				AND code_grp_nm LIKE CONCAT('%', #{params.searchText}, '%')
		 			</if>
		 		</when>
		 		
		 		<when test="params.searchOption == 'code_grp_desc'" >
		 			<if test="params.searchText != null">
		 				AND code_grp_desc LIKE CONCAT('%', #{params.searchText}, '%')
		 			</if>
		 		</when>
		 	</choose>
		 	
			<if test="params.useYnOption != ''">
				AND use_yn = #{params.useYnOption}
	 		</if>	
	</select>
   	
   	<!-- 공통코드그룹관리 등록 및 수정 -->
   	<insert id="codegrpMngMerge" parameterType="kr.co.trito.tams.web.standard.codegrp.dto.CodegrpDto">
   		INSERT INTO tb_com_code_grp
		       SET code_grp_id 		= #{codeGrpId}
		         , code_grp_nm 		= #{codeGrpNm}
		         , code_grp_eng_nm 	= #{codeGrpEngNm}
		         , code_grp_desc 	= #{codeGrpDesc}
		         , sort_odr 		= #{sortOdr}
		         , use_yn 			= #{useYn}
		         , regr 			= #{regr}
		         , reg_dt 			= now()
		         
		       ON  DUPLICATE KEY UPDATE
		           code_grp_nm 		= #{codeGrpNm}
		         , code_grp_eng_nm 	= #{codeGrpEngNm}
		         , code_grp_desc 	= #{codeGrpDesc}
		         , sort_odr 		= #{sortOdr}
		         , use_yn 			= #{useYn}
		         , updr 			= #{updr}
		         , up_dt 			= now()
	</insert>
	
	<!-- 공통코드그룹관리 삭제 -->   	
   	<delete id="codegrpMngDelete" parameterType="kr.co.trito.tams.web.standard.codegrp.dto.CodegrpDto">
		DELETE 
		FROM tb_com_code_grp 
        WHERE code_grp_id = #{codeGrpId}
	</delete>
</mapper>